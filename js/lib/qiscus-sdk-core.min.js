!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("QiscusSDKCore",[],e):"object"==typeof exports?exports.QiscusSDKCore=e():t.QiscusSDKCore=e()}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=72)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){(function(n){var i;
/*!
 * is.js 0.8.0
 * Author: Aras Atasaygin
 */!function(o,s){void 0===(i=function(){return o.is=function(){var t={VERSION:"0.8.0",not:{},all:{},any:{}},e=Object.prototype.toString,r=Array.prototype.slice,i=Object.prototype.hasOwnProperty;function o(t){return function(){return!t.apply(null,r.call(arguments))}}function s(t){return function(){for(var e=l(arguments),r=e.length,n=0;n<r;n++)if(!t.call(null,e[n]))return!1;return!0}}function a(t){return function(){for(var e=l(arguments),r=e.length,n=0;n<r;n++)if(t.call(null,e[n]))return!0;return!1}}var u={"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},">":function(t,e){return t>e},">=":function(t,e){return t>=e}};function c(t,e){var r=e+"",n=+(r.match(/\d+/)||NaN),i=r.match(/^[<>]=?|/)[0];return u[i]?u[i](t,n):t==n||n!=n}function l(e){var n=r.call(e),i=n.length;return 1===i&&t.array(n[0])&&(n=n[0]),n}t.arguments=function(t){return"[object Arguments]"===e.call(t)||null!=t&&"object"==typeof t&&"callee"in t},t.array=Array.isArray||function(t){return"[object Array]"===e.call(t)},t.boolean=function(t){return!0===t||!1===t||"[object Boolean]"===e.call(t)},t.char=function(e){return t.string(e)&&1===e.length},t.date=function(t){return"[object Date]"===e.call(t)},t.domNode=function(e){return t.object(e)&&e.nodeType>0},t.error=function(t){return"[object Error]"===e.call(t)},t.function=function(t){return"[object Function]"===e.call(t)||"function"==typeof t},t.json=function(t){return"[object Object]"===e.call(t)},t.nan=function(t){return t!=t},t.null=function(t){return null===t},t.number=function(r){return t.not.nan(r)&&"[object Number]"===e.call(r)},t.object=function(t){return Object(t)===t},t.regexp=function(t){return"[object RegExp]"===e.call(t)},t.sameType=function(r,n){var i=e.call(r);return i===e.call(n)&&("[object Number]"!==i||(!t.any.nan(r,n)||t.all.nan(r,n)))},t.sameType.api=["not"],t.string=function(t){return"[object String]"===e.call(t)},t.undefined=function(t){return void 0===t},t.windowObject=function(t){return null!=t&&"object"==typeof t&&"setInterval"in t},t.empty=function(e){if(t.object(e)){var r=Object.getOwnPropertyNames(e).length;return!!(0===r||1===r&&t.array(e)||2===r&&t.arguments(e))}return""===e},t.existy=function(t){return null!=t},t.falsy=function(t){return!t},t.truthy=o(t.falsy),t.above=function(e,r){return t.all.number(e,r)&&e>r},t.above.api=["not"],t.decimal=function(e){return t.number(e)&&e%1!=0},t.equal=function(e,r){return t.all.number(e,r)?e===r&&1/e==1/r:t.all.string(e,r)||t.all.regexp(e,r)?""+e==""+r:!!t.all.boolean(e,r)&&e===r},t.equal.api=["not"],t.even=function(e){return t.number(e)&&e%2==0},t.finite=isFinite||function(e){return t.not.infinite(e)&&t.not.nan(e)},t.infinite=function(t){return t===1/0||t===-1/0},t.integer=function(e){return t.number(e)&&e%1==0},t.negative=function(e){return t.number(e)&&e<0},t.odd=function(e){return t.number(e)&&e%2==1},t.positive=function(e){return t.number(e)&&e>0},t.under=function(e,r){return t.all.number(e,r)&&e<r},t.under.api=["not"],t.within=function(e,r,n){return t.all.number(e,r,n)&&e>r&&e<n},t.within.api=["not"];var f={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([\/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/};function h(e,r){t[e]=function(t){return r[e].test(t)}}for(var p in f)f.hasOwnProperty(p)&&h(p,f);t.ip=function(e){return t.ipv4(e)||t.ipv6(e)},t.capitalized=function(e){if(t.not.string(e))return!1;for(var r=e.split(" "),n=0;n<r.length;n++){var i=r[n];if(i.length){var o=i.charAt(0);if(o!==o.toUpperCase())return!1}}return!0},t.endWith=function(e,r){if(t.not.string(e))return!1;r+="";var n=e.length-r.length;return n>=0&&e.indexOf(r,n)===n},t.endWith.api=["not"],t.include=function(t,e){return t.indexOf(e)>-1},t.include.api=["not"],t.lowerCase=function(e){return t.string(e)&&e===e.toLowerCase()},t.palindrome=function(e){if(t.not.string(e))return!1;for(var r=(e=e.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).length-1,n=0,i=Math.floor(r/2);n<=i;n++)if(e.charAt(n)!==e.charAt(r-n))return!1;return!0},t.space=function(e){if(t.not.char(e))return!1;var r=e.charCodeAt(0);return r>8&&r<14||32===r},t.startWith=function(e,r){return t.string(e)&&0===e.indexOf(r)},t.startWith.api=["not"],t.upperCase=function(e){return t.string(e)&&e===e.toUpperCase()};var d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];t.day=function(e,r){return t.date(e)&&r.toLowerCase()===d[e.getDay()]},t.day.api=["not"],t.dayLightSavingTime=function(t){var e=new Date(t.getFullYear(),0,1),r=new Date(t.getFullYear(),6,1),n=Math.max(e.getTimezoneOffset(),r.getTimezoneOffset());return t.getTimezoneOffset()<n},t.future=function(e){var r=new Date;return t.date(e)&&e.getTime()>r.getTime()},t.inDateRange=function(e,r,n){if(t.not.date(e)||t.not.date(r)||t.not.date(n))return!1;var i=e.getTime();return i>r.getTime()&&i<n.getTime()},t.inDateRange.api=["not"],t.inLastMonth=function(e){return t.inDateRange(e,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date)},t.inLastWeek=function(e){return t.inDateRange(e,new Date((new Date).setDate((new Date).getDate()-7)),new Date)},t.inLastYear=function(e){return t.inDateRange(e,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date)},t.inNextMonth=function(e){return t.inDateRange(e,new Date,new Date((new Date).setMonth((new Date).getMonth()+1)))},t.inNextWeek=function(e){return t.inDateRange(e,new Date,new Date((new Date).setDate((new Date).getDate()+7)))},t.inNextYear=function(e){return t.inDateRange(e,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1)))},t.leapYear=function(e){return t.number(e)&&(e%4==0&&e%100!=0||e%400==0)},t.month=function(e,r){return t.date(e)&&r.toLowerCase()===m[e.getMonth()]},t.month.api=["not"],t.past=function(e){var r=new Date;return t.date(e)&&e.getTime()<r.getTime()},t.quarterOfYear=function(e,r){return t.date(e)&&t.number(r)&&r===Math.floor((e.getMonth()+3)/3)},t.quarterOfYear.api=["not"],t.today=function(e){var r=new Date,n=r.toDateString();return t.date(e)&&e.toDateString()===n},t.tomorrow=function(e){var r=new Date,n=new Date(r.setDate(r.getDate()+1)).toDateString();return t.date(e)&&e.toDateString()===n},t.weekend=function(e){return t.date(e)&&(6===e.getDay()||0===e.getDay())},t.weekday=o(t.weekend),t.year=function(e,r){return t.date(e)&&t.number(r)&&r===e.getFullYear()},t.year.api=["not"],t.yesterday=function(e){var r=new Date,n=new Date(r.setDate(r.getDate()-1)).toDateString();return t.date(e)&&e.toDateString()===n};var v=t.windowObject("object"==typeof n&&n)&&n,y=t.windowObject("object"==typeof self&&self)&&self,g=t.windowObject("object"==typeof this&&this)&&this,_=v||y||g||Function("return this")(),b=y&&y.document,w=_.is,k=y&&y.navigator,S=(k&&k.appVersion||"").toLowerCase(),E=(k&&k.userAgent||"").toLowerCase(),x=(k&&k.vendor||"").toLowerCase();return t.android=function(){return/android/.test(E)},t.android.api=["not"],t.androidPhone=function(){return/android/.test(E)&&/mobile/.test(E)},t.androidPhone.api=["not"],t.androidTablet=function(){return/android/.test(E)&&!/mobile/.test(E)},t.androidTablet.api=["not"],t.blackberry=function(){return/blackberry/.test(E)||/bb10/.test(E)},t.blackberry.api=["not"],t.chrome=function(t){var e=/google inc/.test(x)?E.match(/(?:chrome|crios)\/(\d+)/):null;return null!==e&&c(e[1],t)},t.chrome.api=["not"],t.desktop=function(){return t.not.mobile()&&t.not.tablet()},t.desktop.api=["not"],t.edge=function(t){var e=E.match(/edge\/(\d+)/);return null!==e&&c(e[1],t)},t.edge.api=["not"],t.firefox=function(t){var e=E.match(/(?:firefox|fxios)\/(\d+)/);return null!==e&&c(e[1],t)},t.firefox.api=["not"],t.ie=function(t){var e=E.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==e&&c(e[1],t)},t.ie.api=["not"],t.ios=function(){return t.iphone()||t.ipad()||t.ipod()},t.ios.api=["not"],t.ipad=function(t){var e=E.match(/ipad.+?os (\d+)/);return null!==e&&c(e[1],t)},t.ipad.api=["not"],t.iphone=function(t){var e=E.match(/iphone(?:.+?os (\d+))?/);return null!==e&&c(e[1]||1,t)},t.iphone.api=["not"],t.ipod=function(t){var e=E.match(/ipod.+?os (\d+)/);return null!==e&&c(e[1],t)},t.ipod.api=["not"],t.linux=function(){return/linux/.test(S)},t.linux.api=["not"],t.mac=function(){return/mac/.test(S)},t.mac.api=["not"],t.mobile=function(){return t.iphone()||t.ipod()||t.androidPhone()||t.blackberry()||t.windowsPhone()},t.mobile.api=["not"],t.offline=o(t.online),t.offline.api=["not"],t.online=function(){return!k||!0===k.onLine},t.online.api=["not"],t.opera=function(t){var e=E.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==e&&c(e[1],t)},t.opera.api=["not"],t.phantom=function(t){var e=E.match(/phantomjs\/(\d+)/);return null!==e&&c(e[1],t)},t.phantom.api=["not"],t.safari=function(t){var e=E.match(/version\/(\d+).+?safari/);return null!==e&&c(e[1],t)},t.safari.api=["not"],t.tablet=function(){return t.ipad()||t.androidTablet()||t.windowsTablet()},t.tablet.api=["not"],t.touchDevice=function(){return!!b&&("ontouchstart"in y||"DocumentTouch"in y&&b instanceof DocumentTouch)},t.touchDevice.api=["not"],t.windows=function(){return/win/.test(S)},t.windows.api=["not"],t.windowsPhone=function(){return t.windows()&&/phone/.test(E)},t.windowsPhone.api=["not"],t.windowsTablet=function(){return t.windows()&&t.not.windowsPhone()&&/touch/.test(E)},t.windowsTablet.api=["not"],t.propertyCount=function(e,r){if(t.not.object(e)||t.not.number(r))return!1;var n=0;for(var o in e)if(i.call(e,o)&&++n>r)return!1;return n===r},t.propertyCount.api=["not"],t.propertyDefined=function(e,r){return t.object(e)&&t.string(r)&&r in e},t.propertyDefined.api=["not"],t.inArray=function(e,r){if(t.not.array(r))return!1;for(var n=0;n<r.length;n++)if(r[n]===e)return!0;return!1},t.inArray.api=["not"],t.sorted=function(e,r){if(t.not.array(e))return!1;for(var n=u[r]||u[">="],i=1;i<e.length;i++)if(!n(e[i],e[i-1]))return!1;return!0},function(){var e=t;for(var r in e)if(i.call(e,r)&&t.function(e[r]))for(var n=e[r].api||["not","all","any"],u=0;u<n.length;u++)"not"===n[u]&&(t.not[r]=o(t[r])),"all"===n[u]&&(t.all[r]=s(t[r])),"any"===n[u]&&(t.any[r]=a(t[r]))}(),t.setNamespace=function(){return _.is=w,this},t.setRegexp=function(t,e){for(var r in f)i.call(f,r)&&e===r&&(f[r]=t)},t}()}.call(e,r,e,t))||(t.exports=i)}(this)}).call(this,r(6))},function(t,e,r){var n=r(38),i=36e5,o=6e4,s=2,a=/[T ]/,u=/:/,c=/^(\d{2})$/,l=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],f=/^(\d{4})/,h=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],p=/^-(\d{2})$/,d=/^-?(\d{3})$/,m=/^-?(\d{2})-?(\d{2})$/,v=/^-?W(\d{2})$/,y=/^-?W(\d{2})-?(\d{1})$/,g=/^(\d{2}([.,]\d*)?)$/,_=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,b=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,w=/([Z+-].*)$/,k=/^(Z)$/,S=/^([+-])(\d{2})$/,E=/^([+-])(\d{2}):?(\d{2})$/;function x(t,e,r){e=e||0,r=r||0;var n=new Date(0);n.setUTCFullYear(t,0,4);var i=7*e+r+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+i),n}t.exports=function(t,e){if(n(t))return new Date(t.getTime());if("string"!=typeof t)return new Date(t);var r=(e||{}).additionalDigits;r=null==r?s:Number(r);var T=function(t){var e,r={},n=t.split(a);if(u.test(n[0])?(r.date=null,e=n[0]):(r.date=n[0],e=n[1]),e){var i=w.exec(e);i?(r.time=e.replace(i[1],""),r.timezone=i[1]):r.time=e}return r}(t),A=function(t,e){var r,n=l[e],i=h[e];if(r=f.exec(t)||i.exec(t)){var o=r[1];return{year:parseInt(o,10),restDateString:t.slice(o.length)}}if(r=c.exec(t)||n.exec(t)){var s=r[1];return{year:100*parseInt(s,10),restDateString:t.slice(s.length)}}return{year:null}}(T.date,r),I=A.year,P=function(t,e){if(null===e)return null;var r,n,i,o;if(0===t.length)return(n=new Date(0)).setUTCFullYear(e),n;if(r=p.exec(t))return n=new Date(0),i=parseInt(r[1],10)-1,n.setUTCFullYear(e,i),n;if(r=d.exec(t)){n=new Date(0);var s=parseInt(r[1],10);return n.setUTCFullYear(e,0,s),n}if(r=m.exec(t)){n=new Date(0),i=parseInt(r[1],10)-1;var a=parseInt(r[2],10);return n.setUTCFullYear(e,i,a),n}if(r=v.exec(t))return o=parseInt(r[1],10)-1,x(e,o);if(r=y.exec(t)){o=parseInt(r[1],10)-1;var u=parseInt(r[2],10)-1;return x(e,o,u)}return null}(A.restDateString,I);if(P){var O,C=P.getTime(),R=0;return T.time&&(R=function(t){var e,r,n;if(e=g.exec(t))return(r=parseFloat(e[1].replace(",",".")))%24*i;if(e=_.exec(t))return r=parseInt(e[1],10),n=parseFloat(e[2].replace(",",".")),r%24*i+n*o;if(e=b.exec(t)){r=parseInt(e[1],10),n=parseInt(e[2],10);var s=parseFloat(e[3].replace(",","."));return r%24*i+n*o+1e3*s}return null}(T.time)),T.timezone?O=function(t){var e,r;return(e=k.exec(t))?0:(e=S.exec(t))?(r=60*parseInt(e[2],10),"+"===e[1]?-r:r):(e=E.exec(t))?(r=60*parseInt(e[2],10)+parseInt(e[3],10),"+"===e[1]?-r:r):0}(T.timezone):(O=new Date(C+R).getTimezoneOffset(),O=new Date(C+R+O*o).getTimezoneOffset()),new Date(C+R+O*o)}return new Date(t)}},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){var n;"undefined"!=typeof window?n=window:"undefined"!=typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=r(77),o=r(78),s=r(37),a=r(79),u=r(81);function c(){}var l=e=t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1==arguments.length?new e.Request("GET",t):new e.Request(t,r)};e.Request=y,l.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var f="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function h(t){if(!s(t))return t;var e=[];for(var r in t)p(e,r,t[r]);return e.join("&")}function p(t,e,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){p(t,e,r)});else if(s(r))for(var n in r)p(t,e+"["+n+"]",r[n]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));else null===r&&t.push(encodeURIComponent(e))}function d(t){for(var e,r,n={},i=t.split("&"),o=0,s=i.length;o<s;++o)-1==(r=(e=i[o]).indexOf("="))?n[decodeURIComponent(e)]="":n[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return n}function m(t){return/[\/+]json($|[^-\w])/.test(t)}function v(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,r,n,i,o=t.split(/\r?\n/),s={},a=0,u=o.length;a<u;++a)-1!==(e=(r=o[a]).indexOf(":"))&&(n=r.slice(0,e).toLowerCase(),i=f(r.slice(e+1)),s[n]=i);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t,e=null,n=null;try{n=new v(r)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",n);try{r._isResponseOK(n)||(t=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=n,t.status=n.status,r.callback(t,n)):r.callback(null,n)})}function g(t,e,r){var n=l("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}l.serializeObject=h,l.parseString=d,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":h,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":d,"application/json":JSON.parse},a(v.prototype),v.prototype._parseBody=function(t){var e=l.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&m(this.type)&&(e=l.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},v.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,n="cannot "+e+" "+r+" ("+this.status+")",i=new Error(n);return i.status=this.status,i.method=e,i.url=r,i},l.Response=v,i(y.prototype),o(y.prototype),y.prototype.type=function(t){return this.set("Content-Type",l.types[t]||t),this},y.prototype.accept=function(t){return this.set("Accept",l.types[t]||t),this},y.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});return this._auth(t,e,r,function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")})},y.prototype.query=function(t){return"string"!=typeof t&&(t=h(t)),t&&this._query.push(t),this},y.prototype.attach=function(t,e,r){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},y.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},y.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},y.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||c,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var t=this,e=this.xhr=l.getXHR(),r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==r){var n;try{n=e.status}catch(t){n=0}if(!n){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var n=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.onprogress=n.bind(null,"download"),e.upload&&(e.upload.onprogress=n.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],o=this._serializer||l.serialize[i?i.split(";")[0]:""];!o&&m(i)&&(o=l.serialize["application/json"]),o&&(r=o(r))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&e.setRequestHeader(s,this.header[s]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==r?r:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){u.prototype[t.toLowerCase()]=function(e,r){var n=new l.Request(t,e);return this._setDefaults(n),r&&n.end(r),n}}),u.prototype.del=u.prototype.delete,l.get=function(t,e,r){var n=l("GET",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},l.head=function(t,e,r){var n=l("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},l.options=function(t,e,r){var n=l("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.del=g,l.delete=g,l.patch=function(t,e,r){var n=l("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.post=function(t,e,r){var n=l("POST",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},l.put=function(t,e,r){var n=l("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var t=a(h);l=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new d(t,e)),1!==c.length||l||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,r){"use strict";var n=r(16);t.exports=function(t){if(!n(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,r){"use strict";t.exports=r(132)()?Symbol:r(133)},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(45),i=r(101),o=r(43);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return c(this,t,e,r)}function c(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=h(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(e,r),i=(t=a(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|p(e.length);return 0===(t=a(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):h(t,e);if("Buffer"===e.type&&o(e.data))return h(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(l(e),t=a(t,e<0?0:0|p(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function h(t,e){var r=e.length<0?0:0|p(e.length);t=a(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function p(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function d(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(t).length;default:if(n)return F(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:y(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):y(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(t,e,r,n,i){var o,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function g(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[r+s]=a}return s}function _(t,e,r,n){return H(F(e,t.length-r),t,r,n)}function b(t,e,r,n){return H(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function w(t,e,r,n){return b(t,e,r,n)}function k(t,e,r,n){return H(B(e),t,r,n)}function S(t,e,r,n){return H(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function E(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,u,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=T));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return c(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return l(e),e<=0?a(t,e):void 0!==r?"string"==typeof n?a(t,e).fill(r,n):a(t,e).fill(r):a(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return f(null,t)},u.allocUnsafeSlow=function(t){return f(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return A(this,e,r);case"latin1":case"binary":return I(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,s=r-e,a=Math.min(o,s),c=this.slice(n,i),l=t.slice(e,r),f=0;f<a;++f)if(c[f]!==l[f]){o=c[f],s=l[f];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return v(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return v(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,t,e,r);case"utf8":case"utf-8":return _(this,t,e,r);case"ascii":return b(this,t,e,r);case"latin1":case"binary":return w(this,t,e,r);case"base64":return k(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function I(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function P(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=N(t[o]);return i}function O(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function j(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function M(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function D(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,o){return o||D(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function L(t,e,r,n,o){return o||D(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||C(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||C(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||C(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||C(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||C(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||C(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||C(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||R(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||R(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):M(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):M(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):M(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):M(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return L(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return L(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=u.isBuffer(t)?t:F(new u(t,n).toString()),a=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function B(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(q,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(6))},function(t,e,r){"use strict";var n=r(19),i=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};t.exports=f;var o=r(21);o.inherits=r(8);var s=r(42),a=r(47);o.inherits(f,s);for(var u=i(a.prototype),c=0;c<u.length;c++){var l=u[c];f.prototype[l]||(f.prototype[l]=a.prototype[l])}function f(t){if(!(this instanceof f))return new f(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),f.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},function(t,e,r){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,r){"use strict";var n=r(17),i=r(55),o=r(32),s=r(56),a=r(57);(t.exports=function(t,e){var r,i,u,c,l;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],n(t)?(r=a.call(t,"c"),i=a.call(t,"e"),u=a.call(t,"w")):(r=u=!0,i=!1),l={value:e,configurable:r,enumerable:i,writable:u},c?o(s(c),l):l}).gs=function(t,e,r){var u,c,l,f;return"string"!=typeof t?(l=r,r=e,e=t,t=null):l=arguments[3],n(e)?i(e)?n(r)?i(r)||(l=r,r=void 0):r=void 0:(l=e,e=r=void 0):e=void 0,n(t)?(u=a.call(t,"c"),c=a.call(t,"e")):(u=!0,c=!1),f={get:e,set:r,configurable:u,enumerable:c},l?o(s(l),f):f}},function(t,e,r){(e=t.exports=r(42)).Stream=e,e.Readable=e,e.Writable=r(47),e.Duplex=r(12),e.Transform=r(49),e.PassThrough=r(108)},function(t,e,r){"use strict";var n=r(51)();t.exports=function(t){return t!==n&&null!==t}},function(t,e,r){"use strict";t.exports=function(t){return void 0!==t&&null!==t}},function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,s,a,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(o(r=this._events[t]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(i(r))for(a=Array.prototype.slice.call(arguments,1),s=(c=r.slice()).length,u=0;u<s;u++)c[u].apply(this,a);return!0},r.prototype.addListener=function(t,e){var s;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(s=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(t,i),r||(r=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},r.prototype.removeListener=function(t,e){var r,o,s,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(r=this._events[t]).length,o=-1,r===e||n(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(r)){for(a=s;a-- >0;)if(r[a]===e||r[a].listener&&r[a].listener===e){o=a;break}if(o<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this,r(7))},function(t,e,r){var n=r(11),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=s),o(i,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,r){(function(t){function r(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===r(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===r(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===r(t)},e.isError=function(t){return"[object Error]"===r(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,r(11).Buffer)},function(t,e,r){var n=r(82),i=r(86),o=r(39),s=r(3),a=r(89),u=r(40);var c={M:function(t){return t.getMonth()+1},MM:function(t){return h(t.getMonth()+1,2)},Q:function(t){return Math.ceil((t.getMonth()+1)/3)},D:function(t){return t.getDate()},DD:function(t){return h(t.getDate(),2)},DDD:function(t){return n(t)},DDDD:function(t){return h(n(t),3)},d:function(t){return t.getDay()},E:function(t){return t.getDay()||7},W:function(t){return i(t)},WW:function(t){return h(i(t),2)},YY:function(t){return h(t.getFullYear(),4).substr(2)},YYYY:function(t){return h(t.getFullYear(),4)},GG:function(t){return String(o(t)).substr(2)},GGGG:function(t){return o(t)},H:function(t){return t.getHours()},HH:function(t){return h(t.getHours(),2)},h:function(t){var e=t.getHours();return 0===e?12:e>12?e%12:e},hh:function(t){return h(c.h(t),2)},m:function(t){return t.getMinutes()},mm:function(t){return h(t.getMinutes(),2)},s:function(t){return t.getSeconds()},ss:function(t){return h(t.getSeconds(),2)},S:function(t){return Math.floor(t.getMilliseconds()/100)},SS:function(t){return h(Math.floor(t.getMilliseconds()/10),2)},SSS:function(t){return h(t.getMilliseconds(),3)},Z:function(t){return f(t.getTimezoneOffset(),":")},ZZ:function(t){return f(t.getTimezoneOffset())},X:function(t){return Math.floor(t.getTime()/1e3)},x:function(t){return t.getTime()}};function l(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|]$/g,""):t.replace(/\\/g,"")}function f(t,e){e=e||"";var r=t>0?"-":"+",n=Math.abs(t),i=n%60;return r+h(Math.floor(n/60),2)+e+h(i,2)}function h(t,e){for(var r=Math.abs(t).toString();r.length<e;)r="0"+r;return r}t.exports=function(t,e,r){var n=e?String(e):"YYYY-MM-DDTHH:mm:ss.SSSZ",i=(r||{}).locale,o=u.format.formatters,f=u.format.formattingTokensRegExp;i&&i.format&&i.format.formatters&&(o=i.format.formatters,i.format.formattingTokensRegExp&&(f=i.format.formattingTokensRegExp));var h=s(t);return a(h)?function(t,e,r){var n,i,o=t.match(r),s=o.length;for(n=0;n<s;n++)i=e[o[n]]||c[o[n]],o[n]=i||l(o[n]);return function(t){for(var e="",r=0;r<s;r++)o[r]instanceof Function?e+=o[r](t,c):e+=o[r];return e}}(n,o,f)(h):"Invalid Date"}},function(t,e,r){(function(e){var r="Expected a function",n=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt,l="object"==typeof e&&e&&e.Object===Object&&e,f="object"==typeof self&&self&&self.Object===Object&&self,h=l||f||Function("return this")(),p=Object.prototype.toString,d=Math.max,m=Math.min,v=function(){return h.Date.now()};function y(t,e,n){var i,o,s,a,u,c,l=0,f=!1,h=!1,p=!0;if("function"!=typeof t)throw new TypeError(r);function y(e){var r=i,n=o;return i=o=void 0,l=e,a=t.apply(n,r)}function b(t){var r=t-c;return void 0===c||r>=e||r<0||h&&t-l>=s}function w(){var t=v();if(b(t))return k(t);u=setTimeout(w,function(t){var r=e-(t-c);return h?m(r,s-(t-l)):r}(t))}function k(t){return u=void 0,p&&i?y(t):(i=o=void 0,a)}function S(){var t=v(),r=b(t);if(i=arguments,o=this,c=t,r){if(void 0===u)return function(t){return l=t,u=setTimeout(w,e),f?y(t):a}(c);if(h)return u=setTimeout(w,e),y(c)}return void 0===u&&(u=setTimeout(w,e)),a}return e=_(e)||0,g(n)&&(f=!!n.leading,s=(h="maxWait"in n)?d(_(n.maxWait)||0,e):s,p="trailing"in n?!!n.trailing:p),S.cancel=function(){void 0!==u&&clearTimeout(u),l=0,i=c=o=u=void 0},S.flush=function(){return void 0===u?a:k(v())},S}function g(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function _(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&p.call(t)==i}(t))return n;if(g(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=g(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var r=a.test(t);return r||u.test(t)?c(t.slice(2),r?2:8):s.test(t)?n:+t}t.exports=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throw new TypeError(r);return g(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),y(t,e,{leading:i,maxWait:e,trailing:o})}}).call(this,r(6))},function(t,e,r){t.exports=r(73)},function(t,e,r){"use strict";t.exports=r(53)()?Object.setPrototypeOf:r(54)},function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call(function(){return arguments}());t.exports=function(t){return n.call(t)===i}},function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call("");t.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||n.call(t)===i)||!1}},function(t,e,r){var n=r(11),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,r){var n=r(87);t.exports=function(t){return n(t,{weekStartsOn:1})}},function(t,e){t.exports=function(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var i in n)r.call(n,i)&&(t[i]=n[i])}return t};var r=Object.prototype.hasOwnProperty},function(t,e,r){"use strict";var n=r(17),i={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!n(t)&&hasOwnProperty.call(i,typeof t)}},function(t,e,r){"use strict";t.exports=r(124)()?Object.assign:r(125)},function(t,e,r){"use strict";var n,i=r(50),o=r(32),s=r(13),a=r(9),u=r(14),c=r(140),l=r(10),f=Object.defineProperty,h=Object.defineProperties;t.exports=n=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");h(this,{__list__:u("w",a(t)),__context__:u("w",e),__nextIndex__:u("w",0)}),e&&(s(e.on),e.on("_add",this._onAdd),e.on("_delete",this._onDelete),e.on("_clear",this._onClear))},delete n.prototype.constructor,h(n.prototype,o({_next:u(function(){var t;if(this.__list__)return this.__redo__&&void 0!==(t=this.__redo__.shift())?t:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:u(function(){return this._createResult(this._next())}),_createResult:u(function(t){return void 0===t?{done:!0,value:void 0}:{done:!1,value:this._resolve(t)}}),_resolve:u(function(t){return this.__list__[t]}),_unBind:u(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:u(function(){return"[object "+(this[l.toStringTag]||"Object")+"]"})},c({_onAdd:u(function(t){t>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,r){e>=t&&(this.__redo__[r]=++e)},this),this.__redo__.push(t)):f(this,"__redo__",u("c",[t])))}),_onDelete:u(function(t){var e;t>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(t))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,r){e>t&&(this.__redo__[r]=--e)},this)))}),_onClear:u(function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0})}))),f(n.prototype,l.iterator,u(function(){return this}))},function(t,e,r){"use strict";var n=r(177);t.exports=function(t,e){var r;function i(n){e.rejectUnauthorized&&t.emit("error",n),r.end()}return e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",e.rejectUnauthorized=!1!==e.rejectUnauthorized,delete e.path,(r=n.connect(e)).on("secureConnect",function(){e.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",i)}),r.on("error",i),r}},function(t,e,r){(function(e,n){var i=r(15),o=r(178),s=r(8),a=r(181),u=e.from&&e.from!==Uint8Array.from?e.from([0]):new e([0]),c=function(t,e){t._corked?t.once("uncork",e):e()},l=function(t,e){return function(r){r?function(t,e){t._autoDestroy&&t.destroy(e)}(t,"premature close"===r.message?null:r):e&&!t._ended&&t.end()}},f=function(t,e,r){if(!(this instanceof f))return new f(t,e,r);i.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)};s(f,i.Duplex),f.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new f(t,e,r)},f.prototype.cork=function(){1==++this._corked&&this.emit("cork")},f.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},f.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed)t&&t.destroy&&t.destroy();else if(null!==t&&!1!==t){var e=this,r=o(t,{writable:!0,readable:!1},l(this,this._forwardEnd)),i=function(){var t=e._ondrain;e._ondrain=null,t&&t()};this._unwrite&&n.nextTick(i),this._writable=t,this._writable.on("drain",i),this._unwrite=function(){e._writable.removeListener("drain",i),r()},this.uncork()}else this.end()},f.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed)t&&t.destroy&&t.destroy();else{if(null===t||!1===t)return this.push(null),void this.resume();var e=this,r=o(t,{writable:!1,readable:!0},l(this)),n=function(){e._forward()},s=function(){e.push(null)};this._drained=!0,this._readable=t,this._readable2=t._readableState?t:function(t){return new i.Readable({objectMode:!0,highWaterMark:16}).wrap(t)}(t),this._readable2.on("readable",n),this._readable2.on("end",s),this._unread=function(){e._readable2.removeListener("readable",n),e._readable2.removeListener("end",s),r()},this._forward()}},f.prototype._read=function(){this._drained=!0,this._forward()},f.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var t;for(this._forwarding=!0;this._drained&&null!==(t=a(this._readable2));)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}},f.prototype.destroy=function(t){if(!this.destroyed){this.destroyed=!0;var e=this;n.nextTick(function(){e._destroy(t)})}},f.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},f.prototype._write=function(t,e,r){return this.destroyed?r():this._corked?c(this,this._write.bind(this,t,e,r)):t===u?this._finish(r):this._writable?void(!1===this._writable.write(t)?this._ondrain=r:r()):r()},f.prototype._finish=function(t){var e=this;this.emit("preend"),c(this,function(){!function(t,e){t?t._writableState&&t._writableState.finished?e():t._writableState?t.end(e):(t.end(),e()):e()}(e._forwardEnd&&e._writable,function(){!1===e._writableState.prefinished&&(e._writableState.prefinished=!0),e.emit("prefinish"),c(e,t)})})},f.prototype.end=function(t,e,r){return"function"==typeof t?this.end(null,null,t):"function"==typeof e?this.end(t,null,e):(this._ended=!0,t&&this.write(t),this._writableState.ending||this.write(u),i.Writable.prototype.end.call(this,r))},t.exports=f}).call(this,r(11).Buffer,r(7))},function(t,e){function r(t,e,r,n,i,o,s){try{var a=t[o](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var s=t.apply(e,n);function a(t){r(s,i,o,a,u,"next",t)}function u(t){r(s,i,o,a,u,"throw",t)}a(void 0)})}}},function(t,e,r){"use strict";t.exports=function(t){return null!==t&&"object"==typeof t}},function(t,e){t.exports=function(t){return t instanceof Date}},function(t,e,r){var n=r(3),i=r(29);t.exports=function(t){var e=n(t),r=e.getFullYear(),o=new Date(0);o.setFullYear(r+1,0,4),o.setHours(0,0,0,0);var s=i(o),a=new Date(0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);var u=i(a);return e.getTime()>=s.getTime()?r+1:e.getTime()>=u.getTime()?r:r-1}},function(t,e,r){var n=r(90),i=r(91);t.exports={distanceInWords:n(),format:i()}},function(t,e,r){"use strict";(function(e){var n=r(30),i=r(15).Readable,o={objectMode:!0},s={clean:!0},a=r(109);function u(t){if(!(this instanceof u))return new u(t);this.options=t||{},this.options=n(s,t),this._inflights=new a}u.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this},u.prototype.createStream=function(){var t=new i(o),r=!1,n=[],s=0;return this._inflights.forEach(function(t,e){n.push(t)}),t._read=function(){!r&&s<n.length?this.push(n[s++]):this.push(null)},t.destroy=function(){if(!r){var t=this;r=!0,e.nextTick(function(){t.emit("close")})}},t},u.prototype.del=function(t,e){return(t=this._inflights.get(t.messageId))?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this},u.prototype.get=function(t,e){return(t=this._inflights.get(t.messageId))?e(null,t):e&&e(new Error("missing packet")),this},u.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()},t.exports=u}).call(this,r(7))},function(t,e,r){"use strict";(function(e,n){var i=r(19);t.exports=_;var o,s=r(43);_.ReadableState=g;r(18).EventEmitter;var a=function(t,e){return t.listeners(e).length},u=r(44),c=r(20).Buffer,l=e.Uint8Array||function(){};var f=r(21);f.inherits=r(8);var h=r(102),p=void 0;p=h&&h.debuglog?h.debuglog("stream"):function(){};var d,m=r(103),v=r(46);f.inherits(_,u);var y=["error","close","destroy","pause","resume"];function g(t,e){o=o||r(12),t=t||{};var n=e instanceof o;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=r(48).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function _(t){if(o=o||r(12),!(this instanceof _))return new _(t);this._readableState=new g(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),u.call(this)}function b(t,e,r,n,i){var o,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,E(t)}(t,s)):(i||(o=function(t,e){var r;(function(t){return c.isBuffer(t)||t instanceof l})(e)||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(s,e)),o?t.emit("error",o):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function(t){return c.from(t)}(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):w(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||0!==e.length?w(t,s,e,!1):T(t,s)):w(t,s,e,!1))):n||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function w(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&E(t)),T(t,e)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),_.prototype.destroy=v.destroy,_.prototype._undestroy=v.undestroy,_.prototype._destroy=function(t,e){this.push(null),e(t)},_.prototype.push=function(t,e){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=c.from(t,e),e=""),r=!0),b(this,t,e,!1,r)},_.prototype.unshift=function(t){return b(this,t,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){return d||(d=r(48).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var k=8388608;function S(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=k?t=k:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function E(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(p("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(x,t):x(t))}function x(t){p("emit readable"),t.emit("readable"),O(t)}function T(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(A,t,e))}function A(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(p("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function I(t){p("readable nexttick read 0"),t.read(0)}function P(t,e){e.reading||(p("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),O(t),e.flowing&&!e.reading&&t.read(0)}function O(t){var e=t._readableState;for(p("flow",e.flowing);e.flowing&&null!==t.read(););}function C(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=function(t,e,r){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():r?function(t,e){var r=e.head,n=1,i=r.data;t-=i.length;for(;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0===(t-=s)){s===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++n}return e.length-=n,i}(t,e):function(t,e){var r=c.allocUnsafe(t),n=e.head,i=1;n.data.copy(r),t-=n.data.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,s),0===(t-=s)){s===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++i}return e.length-=i,r}(t,e);return n}(t,e.buffer,e.decoder),r);var r}function R(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i.nextTick(j,e,t))}function j(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function M(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}_.prototype.read=function(t){p("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return p("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?R(this):E(this),null;if(0===(t=S(t,e))&&e.ended)return 0===e.length&&R(this),null;var n,i=e.needReadable;return p("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&p("length less than watermark",i=!0),e.ended||e.reading?p("reading or ended",i=!1):i&&(p("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=S(r,e))),null===(n=t>0?C(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&R(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(t,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,p("pipe count=%d opts=%j",o.pipesCount,e);var u=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?l:_;function c(e,n){p("onunpipe"),e===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,p("cleanup"),t.removeListener("close",y),t.removeListener("finish",g),t.removeListener("drain",f),t.removeListener("error",v),t.removeListener("unpipe",c),r.removeListener("end",l),r.removeListener("end",_),r.removeListener("data",m),h=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||f())}function l(){p("onend"),t.end()}o.endEmitted?i.nextTick(u):r.once("end",u),t.on("unpipe",c);var f=function(t){return function(){var e=t._readableState;p("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,O(t))}}(r);t.on("drain",f);var h=!1;var d=!1;function m(e){p("ondata"),d=!1,!1!==t.write(e)||d||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==M(o.pipes,t))&&!h&&(p("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,d=!0),r.pause())}function v(e){p("onerror",e),_(),t.removeListener("error",v),0===a(t,"error")&&t.emit("error",e)}function y(){t.removeListener("finish",g),_()}function g(){p("onfinish"),t.removeListener("close",y),_()}function _(){p("unpipe"),r.unpipe(t)}return r.on("data",m),function(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(t,"error",v),t.once("close",y),t.once("finish",g),t.emit("pipe",r),o.flowing||(p("pipe resume"),r.resume()),t},_.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=M(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)},_.prototype.on=function(t,e){var r=u.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&E(this):i.nextTick(I,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var t=this._readableState;return t.flowing||(p("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(P,t,e))}(this,t)),this},_.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;for(var i in t.on("end",function(){if(p("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(i){(p("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(e.push(i)||(n=!0,t.pause())))}),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<y.length;o++)t.on(y[o],this.emit.bind(this,y[o]));return this._read=function(e){p("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=C}).call(this,r(6),r(7))},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){t.exports=r(18).EventEmitter},function(t,e,r){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){for(var e,r=c(t),n=r[0],s=r[1],a=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,s)),u=0,l=s>0?n-4:n,f=0;f<l;f+=4)e=i[t.charCodeAt(f)]<<18|i[t.charCodeAt(f+1)]<<12|i[t.charCodeAt(f+2)]<<6|i[t.charCodeAt(f+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=255&e;2===s&&(e=i[t.charCodeAt(f)]<<2|i[t.charCodeAt(f+1)]>>4,a[u++]=255&e);1===s&&(e=i[t.charCodeAt(f)]<<10|i[t.charCodeAt(f+1)]<<4|i[t.charCodeAt(f+2)]>>2,a[u++]=e>>8&255,a[u++]=255&e);return a},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(f(t,s,s+16383>a?a:s+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function l(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function f(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(l(n));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e,r){"use strict";var n=r(19);function i(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(n.nextTick(i,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,r){"use strict";(function(e,n,i){var o=r(19);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,r){var n=t.entry;t.entry=null;for(;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=g;var a,u=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:o.nextTick;g.WritableState=y;var c=r(21);c.inherits=r(8);var l={deprecate:r(107)},f=r(44),h=r(20).Buffer,p=i.Uint8Array||function(){};var d,m=r(46);function v(){}function y(t,e){a=a||r(12),t=t||{};var n=e instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,c=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(c||0===c)?c:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===t.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function(t,e,r,n,i){--e.pendingcb,r?(o.nextTick(i,n),o.nextTick(E,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),E(t,e))}(t,r,n,e,i);else{var s=k(r);s||r.corked||r.bufferProcessing||!r.bufferedRequest||w(t,r),n?u(b,t,r,s,i):b(t,r,s,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function g(t){if(a=a||r(12),!(d.call(g,this)||this instanceof a))return new g(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),f.call(this)}function _(t,e,r,n,i,o,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function b(t,e,r,n){r||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),E(t,e)}function w(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var a=0,u=!0;r;)i[a]=r,r.isBuf||(u=!1),r=r.next,a+=1;i.allBuffers=u,_(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(_(t,e,!1,e.objectMode?1:c.length,c,l,f),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function k(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function S(t,e){t._final(function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),E(t,e)})}function E(t,e){var r=k(e);return r&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(S,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}c.inherits(g,f),y.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(y.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(t){return!!d.call(this,t)||this===g&&(t&&t._writableState instanceof y)}})):d=function(t){return t instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&function(t){return h.isBuffer(t)||t instanceof p}(t);return s&&!h.isBuffer(t)&&(t=function(t){return h.from(t)}(t)),"function"==typeof e&&(r=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),"function"!=typeof r&&(r=v),n.ended?function(t,e){var r=new Error("write after end");t.emit("error",r),o.nextTick(e,r)}(this,r):(s||function(t,e,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),o.nextTick(n,s),i=!1),i}(this,n,t,r))&&(n.pendingcb++,i=function(t,e,r,n,i,o){if(!r){var s=function(t,e,r){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=h.from(e,r));return e}(e,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=e.objectMode?1:n.length;e.length+=a;var u=e.length<e.highWaterMark;u||(e.needDrain=!0);if(e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,a,n,i,o);return u}(this,n,s,t,e,r)),i},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||w(this,t))},g.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!==t&&void 0!==t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,r){e.ending=!0,E(t,e),r&&(e.finished?o.nextTick(r):t.once("finish",r));e.ended=!0,t.writable=!1}(this,n,r)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),g.prototype.destroy=m.destroy,g.prototype._undestroy=m.undestroy,g.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,r(7),r(105).setImmediate,r(6))},function(t,e,r){"use strict";var n=r(20).Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=u,this.end=c,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=l,this.end=f,e=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,r=function(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function u(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function c(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function l(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function f(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function h(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},o.prototype.text=function(t,e){var r=function(t,e,r){var n=e.length-1;if(n<r)return 0;var i=s(e[n]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(e[n]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(e[n]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,r){"use strict";t.exports=o;var n=r(12),i=r(21);function o(t){if(!(this instanceof o))return new o(t);n.call(this,t),this._transformState={afterTransform:function(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush(function(e,r){a(t,e,r)}):a(this,null,null)}function a(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=r(8),i.inherits(o,n),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,function(t){e(t),r.emit("close")})}},function(t,e,r){"use strict";var n=r(9);t.exports=function(){return n(this).length=0,this}},function(t,e,r){"use strict";t.exports=function(){}},function(t,e,r){"use strict";var n=r(116),i=Math.max;t.exports=function(t){return i(0,n(t))}},function(t,e,r){"use strict";var n=Object.create,i=Object.getPrototypeOf,o={};t.exports=function(){var t=Object.setPrototypeOf,e=arguments[0]||n;return"function"==typeof t&&i(t(e(null),o))===o}},function(t,e,r){"use strict";var n,i=r(120),o=r(9),s=Object.prototype.isPrototypeOf,a=Object.defineProperty,u={configurable:!0,enumerable:!1,writable:!0,value:void 0};n=function(t,e){if(o(t),null===e||i(e))return t;throw new TypeError("Prototype must be null or an object")},t.exports=function(t){var e,r;return t?(2===t.level?t.set?(r=t.set,e=function(t,e){return r.call(n(t,e),e),t}):e=function(t,e){return n(t,e).__proto__=e,t}:e=function t(e,r){var i;return n(e,r),(i=s.call(t.nullPolyfill,e))&&delete t.nullPolyfill.__proto__,null===r&&(r=t.nullPolyfill),e.__proto__=r,i&&a(t.nullPolyfill,"__proto__",u),e},Object.defineProperty(e,"level",{configurable:!1,enumerable:!1,writable:!1,value:t.level})):null}(function(){var t,e=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(t=n.set).call(e,r)}catch(t){}if(Object.getPrototypeOf(e)===r)return{set:t,level:2}}return e.__proto__=r,Object.getPrototypeOf(e)===r?{level:2}:((e={}).__proto__=r,Object.getPrototypeOf(e)===r&&{level:1})}()),r(121)},function(t,e,r){"use strict";var n=r(122),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;t.exports=function(t){return!!n(t)&&!i.test(o.call(t))}},function(t,e,r){"use strict";var n=r(16),i=Array.prototype.forEach,o=Object.create;t.exports=function(t){var e=o(null);return i.call(arguments,function(t){n(t)&&function(t,e){var r;for(r in t)e[r]=t[r]}(Object(t),e)}),e}},function(t,e,r){"use strict";t.exports=r(129)()?String.prototype.contains:r(130)},function(t,e,r){"use strict";var n=r(136);t.exports=function(t){if(!n(t))throw new TypeError(t+" is not iterable");return t}},function(t,e,r){"use strict";var n=r(17),i=r(31),o=r(142),s=r(143),a=function(t,e){return t.replace("%v",s(e))};t.exports=function(t,e,r){if(!i(r))throw new TypeError(a(e,t));if(!n(t)){if("default"in r)return r.default;if(r.isOptional)return null}var s=o(r.errorMessage);throw n(s)||(s=e),new TypeError(a(s,t))}},function(t,e,r){"use strict";var n=r(28).Buffer,i=t.exports;for(var o in i.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},i.codes={},i.types){var s=i.types[o];i.codes[s]=o}for(var a in i.CMD_SHIFT=4,i.CMD_MASK=240,i.DUP_MASK=8,i.QOS_MASK=3,i.QOS_SHIFT=1,i.RETAIN_MASK=1,i.LENGTH_MASK=127,i.LENGTH_FIN_MASK=128,i.SESSIONPRESENT_MASK=1,i.SESSIONPRESENT_HEADER=n.from([i.SESSIONPRESENT_MASK]),i.CONNACK_HEADER=n.from([i.codes.connack<<i.CMD_SHIFT]),i.USERNAME_MASK=128,i.PASSWORD_MASK=64,i.WILL_RETAIN_MASK=32,i.WILL_QOS_MASK=24,i.WILL_QOS_SHIFT=3,i.WILL_FLAG_MASK=4,i.CLEAN_SESSION_MASK=2,i.CONNECT_HEADER=n.from([i.codes.connect<<i.CMD_SHIFT]),i.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},i.propertiesCodes={},i.properties){var u=i.properties[a];i.propertiesCodes[u]=a}function c(t){return[0,1,2].map(function(e){return[0,1].map(function(r){return[0,1].map(function(o){var s=n.alloc(1);return s.writeUInt8(i.codes[t]<<i.CMD_SHIFT|(r?i.DUP_MASK:0)|e<<i.QOS_SHIFT|o,0,!0),s})})})}i.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},i.PUBLISH_HEADER=c("publish"),i.SUBSCRIBE_HEADER=c("subscribe"),i.SUBSCRIBE_OPTIONS_QOS_MASK=3,i.SUBSCRIBE_OPTIONS_NL_MASK=1,i.SUBSCRIBE_OPTIONS_NL_SHIFT=2,i.SUBSCRIBE_OPTIONS_RAP_MASK=1,i.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,i.SUBSCRIBE_OPTIONS_RH_MASK=3,i.SUBSCRIBE_OPTIONS_RH_SHIFT=4,i.SUBSCRIBE_OPTIONS_RH=[0,16,32],i.SUBSCRIBE_OPTIONS_NL=4,i.SUBSCRIBE_OPTIONS_RAP=8,i.SUBSCRIBE_OPTIONS_QOS=[0,1,2],i.UNSUBSCRIBE_HEADER=c("unsubscribe"),i.ACKS={unsuback:c("unsuback"),puback:c("puback"),pubcomp:c("pubcomp"),pubrel:c("pubrel"),pubrec:c("pubrec")},i.SUBACK_HEADER=n.from([i.codes.suback<<i.CMD_SHIFT]),i.VERSION3=n.from([3]),i.VERSION4=n.from([4]),i.VERSION5=n.from([5]),i.QOS=[0,1,2].map(function(t){return n.from([t])}),i.EMPTY={pingreq:n.from([i.codes.pingreq<<4,0]),pingresp:n.from([i.codes.pingresp<<4,0]),disconnect:n.from([i.codes.disconnect<<4,0])}},function(t,e,r){"use strict";var n=r(60),i=r(28).Buffer,o=i.allocUnsafe(0),s=i.from([0]),a=r(167),u=r(19).nextTick,c=a.cache,l=a.generateNumber,f=a.generateCache,h=a.genBufVariableByteInt,p=a.generate4ByteBuffer,d=k,m=!0;function v(t,e,r){switch(e.cork&&(e.cork(),u(y,e)),m&&(m=!1,f()),t.cmd){case"connect":return function(t,e,r){var o=t||{},s=o.protocolId||"MQTT",a=o.protocolVersion||4,u=o.will,c=o.clean,l=o.keepalive||0,f=o.clientId||"",h=o.username,p=o.password,m=o.properties;void 0===c&&(c=!0);var v=0;if(!s||"string"!=typeof s&&!i.isBuffer(s))return e.emit("error",new Error("Invalid protocolId")),!1;v+=s.length+2;if(3!==a&&4!==a&&5!==a)return e.emit("error",new Error("Invalid protocol version")),!1;v+=1;if("string"!=typeof f&&!i.isBuffer(f)||!f&&4!==a||!f&&!c){if(a<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*c==0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else v+=f.length+2;if("number"!=typeof l||l<0||l>65535||l%1!=0)return e.emit("error",new Error("Invalid keepalive")),!1;v+=2;if(v+=1,5===a){var y=x(e,m);v+=y.length}if(u){if("object"!=typeof u)return e.emit("error",new Error("Invalid will")),!1;if(!u.topic||"string"!=typeof u.topic)return e.emit("error",new Error("Invalid will topic")),!1;if(v+=i.byteLength(u.topic)+2,v+=2,u.payload){if(!(u.payload.length>=0))return e.emit("error",new Error("Invalid will payload")),!1;"string"==typeof u.payload?v+=i.byteLength(u.payload):v+=u.payload.length}var g={};5===a&&(g=x(e,u.properties),v+=g.length)}var w=!1;if(null!=h){if(!O(h))return e.emit("error",new Error("Invalid username")),!1;w=!0,v+=i.byteLength(h)+2}if(null!=p){if(!w)return e.emit("error",new Error("Username is required to use password")),!1;if(!O(p))return e.emit("error",new Error("Invalid password")),!1;v+=P(p)+2}e.write(n.CONNECT_HEADER),_(e,v),E(e,s),e.write(4===a?n.VERSION4:5===a?n.VERSION5:n.VERSION3);var k=0;k|=null!=h?n.USERNAME_MASK:0,k|=null!=p?n.PASSWORD_MASK:0,k|=u&&u.retain?n.WILL_RETAIN_MASK:0,k|=u&&u.qos?u.qos<<n.WILL_QOS_SHIFT:0,k|=u?n.WILL_FLAG_MASK:0,k|=c?n.CLEAN_SESSION_MASK:0,e.write(i.from([k])),d(e,l),5===a&&y.write();E(e,f),u&&(5===a&&g.write(),b(e,u.topic),E(e,u.payload));null!=h&&E(e,h);null!=p&&E(e,p);return!0}(t,e);case"connack":return function(t,e,r){var o=r?r.protocolVersion:4,a=t||{},u=5===o?a.reasonCode:a.returnCode,c=a.properties,l=2;if("number"!=typeof u)return e.emit("error",new Error("Invalid return code")),!1;var f=null;5===o&&(f=x(e,c),l+=f.length);e.write(n.CONNACK_HEADER),_(e,l),e.write(a.sessionPresent?n.SESSIONPRESENT_HEADER:s),e.write(i.from([u])),null!=f&&f.write();return!0}(t,e,r);case"publish":return function(t,e,r){var s=r?r.protocolVersion:4,a=t||{},u=a.qos||0,c=a.retain?n.RETAIN_MASK:0,l=a.topic,f=a.payload||o,h=a.messageId,p=a.properties,m=0;if("string"==typeof l)m+=i.byteLength(l)+2;else{if(!i.isBuffer(l))return e.emit("error",new Error("Invalid topic")),!1;m+=l.length+2}i.isBuffer(f)?m+=f.length:m+=i.byteLength(f);if(u&&"number"!=typeof h)return e.emit("error",new Error("Invalid messageId")),!1;u&&(m+=2);var v=null;5===s&&(v=x(e,p),m+=v.length);e.write(n.PUBLISH_HEADER[u][a.dup?1:0][c?1:0]),_(e,m),d(e,P(l)),e.write(l),u>0&&d(e,h);null!=v&&v.write();return e.write(f)}(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.cmd||"puback",u=s.messageId,c=s.dup&&"pubrel"===a?n.DUP_MASK:0,l=0,f=s.reasonCode,h=s.properties,p=5===o?3:2;"pubrel"===a&&(l=1);if("number"!=typeof u)return e.emit("error",new Error("Invalid messageId")),!1;var m=null;if(5===o){if(!(m=T(e,h,r,p)))return!1;p+=m.length}e.write(n.ACKS[a][l][c][0]),_(e,p),d(e,u),5===o&&e.write(i.from([f]));null!==m&&m.write();return!0}(t,e,r);case"subscribe":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.dup?n.DUP_MASK:0,u=s.messageId,c=s.subscriptions,l=s.properties,f=0;if("number"!=typeof u)return e.emit("error",new Error("Invalid messageId")),!1;f+=2;var h=null;5===o&&(h=x(e,l),f+=h.length);if("object"!=typeof c||!c.length)return e.emit("error",new Error("Invalid subscriptions")),!1;for(var p=0;p<c.length;p+=1){var m=c[p].topic,v=c[p].qos;if("string"!=typeof m)return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof v)return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===o){var y=c[p].nl||!1;if("boolean"!=typeof y)return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var g=c[p].rap||!1;if("boolean"!=typeof g)return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var w=c[p].rh||0;if("number"!=typeof w||w>2)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}f+=i.byteLength(m)+2+1}e.write(n.SUBSCRIBE_HEADER[1][a?1:0][0]),_(e,f),d(e,u),null!==h&&h.write();for(var k=!0,S=0;S<c.length;S++){var E,T=c[S],A=T.topic,I=T.qos,P=+T.nl,O=+T.rap,C=T.rh;b(e,A),E=n.SUBSCRIBE_OPTIONS_QOS[I],5===o&&(E|=P?n.SUBSCRIBE_OPTIONS_NL:0,E|=O?n.SUBSCRIBE_OPTIONS_RAP:0,E|=C?n.SUBSCRIBE_OPTIONS_RH[C]:0),k=e.write(i.from([E]))}return k}(t,e,r);case"suback":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,u=s.granted,c=s.properties,l=0;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;l+=2;if("object"!=typeof u||!u.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var f=0;f<u.length;f+=1){if("number"!=typeof u[f])return e.emit("error",new Error("Invalid qos vector")),!1;l+=1}var h=null;if(5===o){if(!(h=T(e,c,r,l)))return!1;l+=h.length}e.write(n.SUBACK_HEADER),_(e,l),d(e,a),null!==h&&h.write();return e.write(i.from(u))}(t,e,r);case"unsubscribe":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,u=s.dup?n.DUP_MASK:0,c=s.unsubscriptions,l=s.properties,f=0;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;f+=2;if("object"!=typeof c||!c.length)return e.emit("error",new Error("Invalid unsubscriptions")),!1;for(var h=0;h<c.length;h+=1){if("string"!=typeof c[h])return e.emit("error",new Error("Invalid unsubscriptions")),!1;f+=i.byteLength(c[h])+2}var p=null;5===o&&(p=x(e,l),f+=p.length);e.write(n.UNSUBSCRIBE_HEADER[1][u?1:0][0]),_(e,f),d(e,a),null!==p&&p.write();for(var m=!0,v=0;v<c.length;v++)m=b(e,c[v]);return m}(t,e,r);case"unsuback":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,u=s.dup?n.DUP_MASK:0,c=s.granted,l=s.properties,f=s.cmd,h=2;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;if(5===o){if("object"!=typeof c||!c.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var p=0;p<c.length;p+=1){if("number"!=typeof c[p])return e.emit("error",new Error("Invalid qos vector")),!1;h+=1}}var m=null;if(5===o){if(!(m=T(e,l,r,h)))return!1;h+=m.length}e.write(n.ACKS[f][0][u][0]),_(e,h),d(e,a),null!==m&&m.write();5===o&&e.write(i.from(c));return!0}(t,e,r);case"pingreq":case"pingresp":return function(t,e,r){return e.write(n.EMPTY[t.cmd])}(t,e);case"disconnect":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.reasonCode,u=s.properties,c=5===o?1:0,l=null;if(5===o){if(!(l=T(e,u,r,c)))return!1;c+=l.length}e.write(i.from([n.codes.disconnect<<4])),_(e,c),5===o&&e.write(i.from([a]));null!==l&&l.write();return!0}(t,e,r);case"auth":return function(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.reasonCode,u=s.properties,c=5===o?1:0;5!==o&&e.emit("error",new Error("Invalid mqtt version for auth packet"));var l=T(e,u,r,c);if(!l)return!1;c+=l.length,e.write(i.from([n.codes.auth<<4])),_(e,c),e.write(i.from([a])),null!==l&&l.write();return!0}(t,e,r);default:return e.emit("error",new Error("Unknown command")),!1}}function y(t){t.uncork()}Object.defineProperty(v,"cacheNumbers",{get:function(){return d===k},set:function(t){t?(c&&0!==Object.keys(c).length||(m=!0),d=k):(m=!1,d=S)}});var g={};function _(t,e){var r=g[e];r||(r=h(e).data,e<16384&&(g[e]=r)),t.write(r)}function b(t,e){var r=i.byteLength(e);d(t,r),t.write(e,"utf8")}function w(t,e,r){b(t,e),b(t,r)}function k(t,e){return t.write(c[e])}function S(t,e){return t.write(l(e))}function E(t,e){"string"==typeof e?b(t,e):e?(d(t,e.length),t.write(e)):d(t,0)}function x(t,e){if("object"!=typeof e||null!=e.length)return{length:1,write:function(){I(t,{},0)}};var r=0;function o(e,r){var o=0;switch(n.propertiesTypes[e]){case"byte":if("boolean"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=2;break;case"int8":if("number"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=2;break;case"binary":if(r&&null===r)return t.emit("error",new Error("Invalid "+e)),!1;o+=1+i.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=3;break;case"int32":if("number"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=5;break;case"var":if("number"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=1+h(r).length;break;case"string":if("string"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=3+i.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return t.emit("error",new Error("Invalid "+e)),!1;o+=Object.getOwnPropertyNames(r).reduce(function(t,e){var n=r[e];return Array.isArray(n)?t+=n.reduce(function(t,r){return t+=3+i.byteLength(e.toString())+2+i.byteLength(r.toString())},0):t+=3+i.byteLength(e.toString())+2+i.byteLength(r[e].toString()),t},0);break;default:return t.emit("error",new Error("Invalid property "+e)),!1}return o}if(e)for(var s in e){var a=0,u=e[s];if(Array.isArray(u))for(var c=0;c<u.length;c++)a+=o(s,u[c]);else a=o(s,u);if(!a)return!1;r+=a}return{length:h(r).length+r,write:function(){I(t,e,r)}}}function T(t,e,r,n){var i=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,s=x(t,e);if(o)for(;n+s.length>o;){var a=i.shift();if(!a||!e[a])return!1;delete e[a],s=x(t,e)}return s}function A(t,e,r){switch(n.propertiesTypes[e]){case"byte":t.write(i.from([n.properties[e]])),t.write(i.from([+r]));break;case"int8":t.write(i.from([n.properties[e]])),t.write(i.from([r]));break;case"binary":t.write(i.from([n.properties[e]])),E(t,r);break;case"int16":t.write(i.from([n.properties[e]])),d(t,r);break;case"int32":t.write(i.from([n.properties[e]])),function(t,e){t.write(p(e))}(t,r);break;case"var":t.write(i.from([n.properties[e]])),_(t,r);break;case"string":t.write(i.from([n.properties[e]])),b(t,r);break;case"pair":Object.getOwnPropertyNames(r).forEach(function(o){var s=r[o];Array.isArray(s)?s.forEach(function(r){t.write(i.from([n.properties[e]])),w(t,o.toString(),r.toString())}):(t.write(i.from([n.properties[e]])),w(t,o.toString(),s.toString()))});break;default:return t.emit("error",new Error("Invalid property "+e+" value: "+r)),!1}}function I(t,e,r){for(var n in _(t,r),e)if(e.hasOwnProperty(n)&&null!==e[n]){var i=e[n];if(Array.isArray(i))for(var o=0;o<i.length;o++)A(t,n,i[o]);else A(t,n,i)}}function P(t){return t?t instanceof i?t.length:i.byteLength(t):0}function O(t){return"string"==typeof t||t instanceof i}t.exports=v},function(t,e,r){"use strict";var n=r(170),i=r(172);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=_,e.resolve=function(t,e){return _(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?_(t,!1,!0).resolveObject(e):e},e.format=function(t){i.isString(t)&&(t=_(t));return t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),f=["%","/","?",";","#"].concat(l),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=r(173);function _(t,e,r){if(t&&i.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,r),n}o.prototype.parse=function(t,e,r){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var _=t=c.join(a);if(_=_.trim(),!r&&1===t.split("#").length){var b=u.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=s.exec(_);if(w){var k=(w=w[0]).toLowerCase();this.protocol=k,_=_.substr(w.length)}if(r||w||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===_.substr(0,2);!S||w&&v[w]||(_=_.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!y[w])){for(var E,x,T=-1,A=0;A<h.length;A++){-1!==(I=_.indexOf(h[A]))&&(-1===T||I<T)&&(T=I)}-1!==(x=-1===T?_.lastIndexOf("@"):_.lastIndexOf("@",T))&&(E=_.slice(0,x),_=_.slice(x+1),this.auth=decodeURIComponent(E)),T=-1;for(A=0;A<f.length;A++){var I;-1!==(I=_.indexOf(f[A]))&&(-1===T||I<T)&&(T=I)}-1===T&&(T=_.length),this.host=_.slice(0,T),_=_.slice(T),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var O=this.hostname.split(/\./),C=(A=0,O.length);A<C;A++){var R=O[A];if(R&&!R.match(p)){for(var j="",M=0,D=R.length;M<D;M++)R.charCodeAt(M)>127?j+="x":j+=R[M];if(!j.match(p)){var U=O.slice(0,A),L=O.slice(A+1),q=R.match(d);q&&(U.push(q[1]),L.unshift(q[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+N,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!m[k])for(A=0,C=l.length;A<C;A++){var B=l[A];if(-1!==_.indexOf(B)){var H=encodeURIComponent(B);H===B&&(H=escape(B)),_=_.split(B).join(H)}}var z=_.indexOf("#");-1!==z&&(this.hash=_.substr(z),_=_.slice(0,z));var Y=_.indexOf("?");if(-1!==Y?(this.search=_.substr(Y),this.query=_.substr(Y+1),e&&(this.query=g.parse(this.query)),_=_.slice(0,Y)):e&&(this.search="",this.query={}),_&&(this.pathname=_),y[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var W=this.search||"";this.path=N+W}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=g.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(_(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var u=Object.keys(t),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(r[l]=t[l])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!y[t.protocol]){for(var f=Object.keys(t),h=0;h<f.length;h++){var p=f[h];r[p]=t[p]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||v[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var m=r.pathname||"",g=r.search||"";r.path=m+g}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),w=b||_||r.host&&t.pathname,k=w,S=r.pathname&&r.pathname.split("/")||[],E=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===S[0]?S[0]=r.host:S.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),w=w&&(""===d[0]||""===S[0])),b)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,S=d;else if(d.length)S||(S=[]),S.pop(),S=S.concat(d),r.search=t.search,r.query=t.query;else if(!i.isNullOrUndefined(t.search)){if(E)r.hostname=r.host=S.shift(),(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift());return r.search=t.search,r.query=t.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=S.slice(-1)[0],T=(r.host||t.host||S.length>1)&&("."===x||".."===x)||""===x,A=0,I=S.length;I>=0;I--)"."===(x=S[I])?S.splice(I,1):".."===x?(S.splice(I,1),A++):A&&(S.splice(I,1),A--);if(!w&&!k)for(;A--;A)S.unshift("..");!w||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),T&&"/"!==S.join("/").substr(-1)&&S.push("");var P,O=""===S[0]||S[0]&&"/"===S[0].charAt(0);E&&(r.hostname=r.host=O?"":S.length?S.shift():"",(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift()));return(w=w||r.host&&S.length)&&!O&&S.unshift(""),S.length?r.pathname=S.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,r){"use strict";var n=r(176);t.exports=function(t,e){var r,i;return e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",r=e.port,i=e.hostname,n.createConnection(r,i)}},function(t,e,r){"use strict";(function(e,n){var i,o,s,a=r(15).Transform,u=r(35);t.exports=function(t,r){if(r.hostname=r.hostname||r.host,!r.hostname)throw new Error("Could not determine host. Specify host manually.");var c="MQIsdp"===r.protocolId&&3===r.protocolVersion?"mqttv3.1":"mqtt";!function(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}(r);var l=function(t,e){var r="wxs"===t.protocol?"wss":"ws",n=r+"://"+t.hostname+t.path;return t.port&&80!==t.port&&443!==t.port&&(n=r+"://"+t.hostname+":"+t.port+t.path),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}(r,t);i=wx.connectSocket({url:l,protocols:c}),o=function(){var t=new a;return t._write=function(t,e,r){i.send({data:t.buffer,success:function(){r()},fail:function(t){r(new Error(t))}})},t._flush=function(t){i.close({success:function(){t()}})},t}(),(s=u.obj())._destroy=function(t,e){i.close({success:function(){e&&e(t)}})};var f=s.destroy;return s.destroy=function(){s.destroy=f;var t=this;n.nextTick(function(){i.close({fail:function(){t._destroy(new Error)}})})}.bind(s),i.onOpen(function(){s.setReadable(o),s.setWritable(o),s.emit("connect")}),i.onMessage(function(t){var r=t.data;r=r instanceof ArrayBuffer?e.from(r):e.from(r,"utf8"),o.push(r)}),i.onClose(function(){s.end(),s.destroy()}),i.onError(function(t){s.destroy(new Error(t.errMsg))}),s}}).call(this,r(11).Buffer,r(7))},function(t,e,r){"use strict";(function(e){var n,i,o,s=r(15).Transform,a=r(35),u=r(45),c=!1;t.exports=function(t,r){if(r.hostname=r.hostname||r.host,!r.hostname)throw new Error("Could not determine host. Specify host manually.");var l="MQIsdp"===r.protocolId&&3===r.protocolVersion?"mqttv3.1":"mqtt";!function(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}(r);var f=function(t,e){var r="alis"===t.protocol?"wss":"ws",n=r+"://"+t.hostname+t.path;return t.port&&80!==t.port&&443!==t.port&&(n=r+"://"+t.hostname+":"+t.port+t.path),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}(r,t);return(n=r.my).connectSocket({url:f,protocols:l}),i=function(){var t=new s;return t._write=function(t,e,r){n.sendSocketMessage({data:t.buffer,success:function(){r()},fail:function(){r(new Error)}})},t._flush=function(t){n.closeSocket({success:function(){t()}})},t}(),o=a.obj(),c||(c=!0,n.onSocketOpen(function(){o.setReadable(i),o.setWritable(i),o.emit("connect")}),n.onSocketMessage(function(t){if("string"==typeof t.data){var r=u.toByteArray(t.data),n=e.from(r);i.push(n)}else{var o=new FileReader;o.addEventListener("load",function(){var t=o.result;t=t instanceof ArrayBuffer?e.from(t):e.from(t,"utf8"),i.push(t)}),o.readAsArrayBuffer(t.data)}}),n.onSocketClose(function(){o.end(),o.destroy()}),n.onSocketError(function(t){o.destroy(t)})),o}}).call(this,r(11).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(182),i=r(62),o=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],s="browser"===e.title;function a(t,e){var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";!function(t){t.hostname||(t.hostname="localhost"),t.port||("wss"===t.protocol?t.port=443:t.port=80),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={}),s||"wss"!==t.protocol||o.forEach(function(e){t.hasOwnProperty(e)&&!t.wsOptions.hasOwnProperty(e)&&(t.wsOptions[e]=t[e])})}(e);var i=function(t,e){var r=t.protocol+"://"+t.hostname+":"+t.port+t.path;return"function"==typeof t.transformWsUrl&&(r=t.transformWsUrl(r,t,e)),r}(e,t);return n(i,[r],e.wsOptions)}t.exports=s?function(t,e){if(e.hostname||(e.hostname=e.host),!e.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=i.parse(document.URL);e.hostname=r.hostname,e.port||(e.port=r.port)}return a(t,e)}:function(t,e){return a(t,e)}}).call(this,r(7))},function(t,e,r){var n=r(74),i=r(75),o=r(76);t.exports=function(t){return n(t)||i(t)||o()}},function(t,e,r){var n=r(93);t.exports=function(t,e){return n(Date.now(),t,e)}},function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=n=function(t){return r(t)}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)},n(e)}t.exports=n},function(t,e,r){"use strict";(function(e){var n=r(100),i=r(41),o=r(62),s=r(30),a={};function u(t,e){if("object"!=typeof t||e||(e=t,t=null),e=e||{},t){var r=o.parse(t,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(e=s(r,e)).protocol)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(function(t){var e;t.auth&&((e=t.auth.match(/^(.+):(.+)$/))?(t.username=e[1],t.password=e[2]):t.username=t.auth)}(e),e.query&&"string"==typeof e.query.clientId&&(e.clientId=e.query.clientId),e.cert&&e.key){if(!e.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(e.protocol))switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}if(!a[e.protocol]){var i=-1!==["mqtts","wss"].indexOf(e.protocol);e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(t,e){return(!i||e%2!=0)&&"function"==typeof a[t]})[0]}if(!1===e.clean&&!e.clientId)throw new Error("Missing clientId for unclean clients");return e.protocol&&(e.defaultProtocol=e.protocol),new n(function(t){return e.servers&&(t._reconnectCount&&t._reconnectCount!==e.servers.length||(t._reconnectCount=0),e.host=e.servers[t._reconnectCount].host,e.port=e.servers[t._reconnectCount].port,e.protocol=e.servers[t._reconnectCount].protocol?e.servers[t._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,t._reconnectCount++),a[e.protocol](t,e)},e)}"browser"!==e.title?(a.mqtt=r(63),a.tcp=r(63),a.ssl=r(34),a.tls=r(34),a.mqtts=r(34)):(a.wx=r(64),a.wxs=r(64),a.ali=r(65),a.alis=r(65)),a.ws=r(66),a.wss=r(66),t.exports=u,t.exports.connect=u,t.exports.MqttClient=n,t.exports.Store=i}).call(this,r(7))},function(t){t.exports={name:"qiscus-sdk-core",version:"2.8.32",description:"Qiscus Web SDK Core",license:"MIT",main:"lib/index.js",browser:"dist/qiscus-sdk-core.min.js",files:["lib","dist"],scripts:{build:"npm-run-all --parallel build:node build:web","build:dev":"npm-run-all --parallel build:node build:web:dev","build:node":"babel -d lib src","build:node:watch":"babel -w -d lib src","build:web":"webpack --env.production --env.target=web","build:web:dev":"webpack --env.development --env.target=web","build:web:watch":"webpack --env.development --env.target=web",dev:"webpack --env.development --progress --colors --watch",watch:"npm-run-all build:web:watch build:node:watch",test:"mocha --require @babel/register --colors 'test/**/*test.js'","test:watch":"npm run test -- -w",clean:"rimraf dist lib",preversion:"npm-run-all clean build",prepublishOnly:"npm-run-all clean build"},devDependencies:{"@babel/cli":"^7.4.3","@babel/core":"^7.1.2","@babel/plugin-proposal-class-properties":"^7.5.5","@babel/plugin-transform-runtime":"^7.4.3","@babel/polyfill":"^7.0.0","@babel/preset-env":"^7.5.5","@babel/register":"^7.4.4","babel-eslint":"^8.0.0","babel-loader":"^8.0.4","babel-minify-webpack-plugin":"^0.2.0","babel-plugin-add-module-exports":"^1.0.0","babel-plugin-date-fns":"^0.1.0",chai:"^4.1.2","chai-spies":"^1.0.0",eslint:"^4.19.1","eslint-config-standard":"^12.0.0","eslint-loader":"^1.9.0","eslint-plugin-import":"^2.16.0","eslint-plugin-node":"^8.0.1","eslint-plugin-promise":"^4.0.1","eslint-plugin-standard":"^4.0.0",mocha:"^5.2.0","npm-run-all":"^4.1.5",rimraf:"^2.6.3",webpack:"^4.22.0","webpack-cli":"^3.1.2"},dependencies:{"@babel/runtime":"^7.4.3","date-fns":"^1.28.5",is_js:"^0.9.0","lodash.throttle":"^4.1.1",mitt:"^1.1.3",mqtt:"^3.0.0",superagent:"^3.6.3"},babel:{presets:[["@babel/preset-env",{modules:"auto"}]],plugins:["@babel/plugin-transform-runtime","@babel/plugin-proposal-class-properties","babel-plugin-add-module-exports","date-fns"]}}},function(t,e,r){t.exports=r(185)},function(t,e,r){var n=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,o=Object.create(i.prototype),s=new A(n||[]);return o._invoke=function(t,e,r){var n=l;return function(i,o){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=E(s,r);if(a){if(a===d)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var u=c(t,e,r);if("normal"===u.type){if(n=r.done?p:f,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(t,r,s),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function m(){}function v(){}function y(){}var g={};g[o]=function(){return this};var _=Object.getPrototypeOf,b=_&&_(_(I([])));b&&b!==r&&n.call(b,o)&&(g=b);var w=y.prototype=m.prototype=Object.create(g);function k(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t){var e;this._invoke=function(r,i){function o(){return new Promise(function(e,o){!function e(r,i,o,s){var a=c(t[r],t,i);if("throw"!==a.type){var u=a.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?Promise.resolve(l.__await).then(function(t){e("next",t,o,s)},function(t){e("throw",t,o,s)}):Promise.resolve(l).then(function(t){u.value=t,o(u)},function(t){return e("throw",t,o,s)})}s(a.arg)}(r,i,e,o)})}return e=e?e.then(o,o):o()}}function E(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function I(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}return{next:P}}function P(){return{value:e,done:!0}}return v.prototype=w.constructor=y,y.constructor=v,y[a]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},k(S.prototype),S.prototype[s]=function(){return this},t.AsyncIterator=S,t.async=function(e,r,n,i){var o=new S(u(e,r,n,i));return t.isGeneratorFunction(r)?o:o.next().then(function(t){return t.done?t.value:o.next()})},k(w),w[a]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=I,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,r){"use strict";var n=r(37);function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(t){return this._parser=t,this},i.prototype.responseType=function(t){return this._responseType=t,this},i.prototype.serialize=function(t){return this._serializer=t,this},i.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},i.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~o.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(t,e){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){r.end(function(r,n){r?e(r):t(n)})})}return this._fullfilledPromise.then(t,e)},i.prototype.catch=function(t){return this.then(void 0,t)},i.prototype.use=function(t){return t(this),this},i.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},i.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},i.prototype.get=function(t){return this._header[t.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(t,e){if(n(t)){for(var r in t)this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},i.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},i.prototype.field=function(t,e){if(null===t||void 0===t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(t)){for(var r in t)this.field(r,t[r]);return this}if(Array.isArray(e)){for(var i in e)this.field(t,e[i]);return this}if(null===e||void 0===e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype._auth=function(t,e,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},i.prototype.withCredentials=function(t){return void 0==t&&(t=!0),this._withCredentials=t,this},i.prototype.redirects=function(t){return this._maxRedirects=t,this},i.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(t){var e=n(t),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&n(this._data))for(var i in t)this._data[i]=t[i];else"string"==typeof t?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(r||this.type("json"),this)},i.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},i.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.substring(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,e)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(t,e,r){if(!this._aborted){var n=new Error(t+e+"ms exceeded");n.timeout=e,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(t,e,r){"use strict";var n=r(80);function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.get=function(t){return this.header[t.toLowerCase()]},i.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=n.type(e);var r=n.params(e);for(var i in r)this[i]=r[i];this.links={};try{t.link&&(this.links=n.parseLinks(t.link))}catch(t){}},i.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce(function(t,e){var r=e.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(t[n]=i),t},{})},e.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var r=e.split(/ *; */),n=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=n,t},{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){r.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}}),r.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},t.exports=r},function(t,e,r){var n=r(3),i=r(83),o=r(84);t.exports=function(t){var e=n(t);return o(e,i(e))+1}},function(t,e,r){var n=r(3);t.exports=function(t){var e=n(t),r=new Date(0);return r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),r}},function(t,e,r){var n=r(85),i=6e4,o=864e5;t.exports=function(t,e){var r=n(t),s=n(e),a=r.getTime()-r.getTimezoneOffset()*i,u=s.getTime()-s.getTimezoneOffset()*i;return Math.round((a-u)/o)}},function(t,e,r){var n=r(3);t.exports=function(t){var e=n(t);return e.setHours(0,0,0,0),e}},function(t,e,r){var n=r(3),i=r(29),o=r(88),s=6048e5;t.exports=function(t){var e=n(t),r=i(e).getTime()-o(e).getTime();return Math.round(r/s)+1}},function(t,e,r){var n=r(3);t.exports=function(t,e){var r=e&&Number(e.weekStartsOn)||0,i=n(t),o=i.getDay(),s=(o<r?7:0)+o-r;return i.setDate(i.getDate()-s),i.setHours(0,0,0,0),i}},function(t,e,r){var n=r(39),i=r(29);t.exports=function(t){var e=n(t),r=new Date(0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),i(r)}},function(t,e,r){var n=r(38);t.exports=function(t){if(n(t))return!isNaN(t);throw new TypeError(toString.call(t)+" is not an instance of Date")}},function(t,e){t.exports=function(){var t={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,r,n){var i;return n=n||{},i="string"==typeof t[e]?t[e]:1===r?t[e].one:t[e].other.replace("{{count}}",r),n.addSuffix?n.comparison>0?"in "+i:i+" ago":i}}}},function(t,e,r){var n=r(92);t.exports=function(){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Su","Mo","Tu","We","Th","Fr","Sa"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=["AM","PM"],a=["am","pm"],u=["a.m.","p.m."],c={MMM:function(e){return t[e.getMonth()]},MMMM:function(t){return e[t.getMonth()]},dd:function(t){return r[t.getDay()]},ddd:function(t){return i[t.getDay()]},dddd:function(t){return o[t.getDay()]},A:function(t){return t.getHours()/12>=1?s[1]:s[0]},a:function(t){return t.getHours()/12>=1?a[1]:a[0]},aa:function(t){return t.getHours()/12>=1?u[1]:u[0]}};return["M","D","DDD","d","Q","W"].forEach(function(t){c[t+"o"]=function(e,r){return function(t){var e=t%100;if(e>20||e<10)switch(e%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"}(r[t](e))}}),{formatters:c,formattingTokensRegExp:n(c)}}},function(t,e){var r=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];t.exports=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);var i=r.concat(e).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+i.join("|")+"|.)","g")}},function(t,e,r){var n=r(94),i=r(3),o=r(95),s=r(97),a=r(40),u=1440,c=2520,l=43200,f=86400;t.exports=function(t,e,r){var h=r||{},p=n(t,e),d=h.locale,m=a.distanceInWords.localize;d&&d.distanceInWords&&d.distanceInWords.localize&&(m=d.distanceInWords.localize);var v,y,g={addSuffix:Boolean(h.addSuffix),comparison:p};p>0?(v=i(t),y=i(e)):(v=i(e),y=i(t));var _,b=o(y,v),w=y.getTimezoneOffset()-v.getTimezoneOffset(),k=Math.round(b/60)-w;if(k<2)return h.includeSeconds?b<5?m("lessThanXSeconds",5,g):b<10?m("lessThanXSeconds",10,g):b<20?m("lessThanXSeconds",20,g):b<40?m("halfAMinute",null,g):m(b<60?"lessThanXMinutes":"xMinutes",1,g):0===k?m("lessThanXMinutes",1,g):m("xMinutes",k,g);if(k<45)return m("xMinutes",k,g);if(k<90)return m("aboutXHours",1,g);if(k<u)return m("aboutXHours",Math.round(k/60),g);if(k<c)return m("xDays",1,g);if(k<l)return m("xDays",Math.round(k/u),g);if(k<f)return m("aboutXMonths",_=Math.round(k/l),g);if((_=s(y,v))<12)return m("xMonths",Math.round(k/l),g);var S=_%12,E=Math.floor(_/12);return S<3?m("aboutXYears",E,g):S<9?m("overXYears",E,g):m("almostXYears",E+1,g)}},function(t,e,r){var n=r(3);t.exports=function(t,e){var r=n(t).getTime(),i=n(e).getTime();return r>i?-1:r<i?1:0}},function(t,e,r){var n=r(96);t.exports=function(t,e){var r=n(t,e)/1e3;return r>0?Math.floor(r):Math.ceil(r)}},function(t,e,r){var n=r(3);t.exports=function(t,e){var r=n(t),i=n(e);return r.getTime()-i.getTime()}},function(t,e,r){var n=r(3),i=r(98),o=r(99);t.exports=function(t,e){var r=n(t),s=n(e),a=o(r,s),u=Math.abs(i(r,s));return r.setMonth(r.getMonth()-a*u),a*(u-(o(r,s)===-a))}},function(t,e,r){var n=r(3);t.exports=function(t,e){var r=n(t),i=n(e);return 12*(r.getFullYear()-i.getFullYear())+(r.getMonth()-i.getMonth())}},function(t,e,r){var n=r(3);t.exports=function(t,e){var r=n(t).getTime(),i=n(e).getTime();return r<i?-1:r>i?1:0}},function(t,e,r){"use strict";(function(e,n){var i=r(18),o=r(41),s=r(159),a=r(15).Writable,u=r(8),c=r(168),l=r(169),f=r(30),h=e.setImmediate||function(t){n.nextTick(t)},p={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},d={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function m(t,e,r){t.emit("packetsend",e),!s.writeToStream(e,t.stream,t.options)&&r?t.stream.once("drain",r):r&&r()}function v(t,e,r,n){t.outgoingStore.put(e,function(i){if(i)return r&&r(i);n(),m(t,e,r)})}function y(){}function g(t,e){var r,n=this;if(!(this instanceof g))return new g(t,e);for(r in this.options=e||{},p)void 0===this.options[r]?this.options[r]=p[r]:this.options[r]=e[r];this.options.clientId="string"==typeof e.clientId?e.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===e.protocolVersion&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.outgoingStore=e.outgoingStore||new o,this.incomingStore=e.incomingStore||new o,this.queueQoSZero=void 0===e.queueQoSZero||e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var t=this.queue;!function e(){var r,i=t.shift();i&&(r=i.packet,n._sendPacket(r,function(t){i.cb&&i.cb(t),e()}))}()}),this.on("close",function(){null!==n.pingTimer&&(n.pingTimer.clear(),n.pingTimer=null)}),this.on("close",this._setupReconnect),i.EventEmitter.call(this),this._setupStream()}u(g,i.EventEmitter),g.prototype._setupStream=function(){var t,e=this,r=new a,i=s.parser(this.options),o=null,u=[];function c(){if(u.length)n.nextTick(l);else{var t=o;o=null,t()}}function l(){var t=u.shift();if(t)e._handlePacket(t,c);else{var r=o;o=null,r&&r()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),i.on("packet",function(t){u.push(t)}),r._write=function(t,e,r){o=r,i.parse(t),l()},this.stream.pipe(r),this.stream.on("error",y),this.stream.on("close",function(){!function(t){t&&Object.keys(t).forEach(function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])})}(e.outgoing),e.emit("close")}),(t=Object.create(this.options)).cmd="connect",m(this,t),i.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket)m(this,f({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){e._cleanUp(!0)},this.options.connectTimeout)},g.prototype._handlePacket=function(t,e){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e()}},g.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},g.prototype.publish=function(t,e,r,n){var i,o=this.options;"function"==typeof r&&(n=r,r=null);if(r=f({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;switch(i={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===o.protocolVersion&&(i.properties=r.properties,(!o.properties&&i.properties&&i.properties.topicAlias||r.properties&&o.properties&&(r.properties.topicAlias&&o.properties.topicAliasMaximum&&r.properties.topicAlias>o.properties.topicAliasMaximum||!o.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete i.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[i.messageId]={volatile:!1,cb:n||y},this._storeProcessing?(this._packetIdsDuringStoreProcessing[i.messageId]=!1,this._storePacket(i,void 0,r.cbStorePut)):this._sendPacket(i,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(i,n,r.cbStorePut):this._sendPacket(i,n,r.cbStorePut)}return this},g.prototype.subscribe=function(){for(var t,e=new Array(arguments.length),r=0;r<arguments.length;r++)e[r]=arguments[r];var n,i=[],o=e.shift(),s=o.resubscribe,a=e.pop()||y,u=e.pop(),c=this,p=this.options.protocolVersion;if(delete o.resubscribe,"string"==typeof o&&(o=[o]),"function"!=typeof a&&(u=a,a=y),null!==(n=l.validateTopics(o)))return h(a,new Error("Invalid topic "+n)),this;if(this._checkDisconnecting(a))return this;var d={qos:0};if(5===p&&(d.nl=!1,d.rap=!1,d.rh=0),u=f(d,u),Array.isArray(o)?o.forEach(function(t){if(!c._resubscribeTopics.hasOwnProperty(t)||c._resubscribeTopics[t].qos<u.qos||s){var e={topic:t,qos:u.qos};5===p&&(e.nl=u.nl,e.rap=u.rap,e.rh=u.rh,e.properties=u.properties),i.push(e)}}):Object.keys(o).forEach(function(t){if(!c._resubscribeTopics.hasOwnProperty(t)||c._resubscribeTopics[t].qos<o[t].qos||s){var e={topic:t,qos:o[t].qos};5===p&&(e.nl=o[t].nl,e.rap=o[t].rap,e.rh=o[t].rh,e.properties=u.properties),i.push(e)}}),t={cmd:"subscribe",subscriptions:i,qos:1,retain:!1,dup:!1,messageId:this._nextId()},u.properties&&(t.properties=u.properties),i.length){if(this.options.resubscribe){var m=[];i.forEach(function(t){if(c.options.reconnectPeriod>0){var e={qos:t.qos};5===p&&(e.nl=t.nl||!1,e.rap=t.rap||!1,e.rh=t.rh||0,e.properties=t.properties),c._resubscribeTopics[t.topic]=e,m.push(t.topic)}}),c.messageIdToTopic[t.messageId]=m}return this.outgoing[t.messageId]={volatile:!0,cb:function(t,e){if(!t)for(var r=e.granted,n=0;n<r.length;n+=1)i[n].qos=r[n];a(t,i)}},this._sendPacket(t),this}a(null,[])},g.prototype.unsubscribe=function(){for(var t={cmd:"unsubscribe",qos:1,messageId:this._nextId()},e=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.shift(),o=r.pop()||y,s=r.pop();return"string"==typeof i&&(i=[i]),"function"!=typeof o&&(s=o,o=y),this._checkDisconnecting(o)?this:("string"==typeof i?t.unsubscriptions=[i]:"object"==typeof i&&i.length&&(t.unsubscriptions=i),this.options.resubscribe&&t.unsubscriptions.forEach(function(t){delete e._resubscribeTopics[t]}),"object"==typeof s&&s.properties&&(t.properties=s.properties),this.outgoing[t.messageId]={volatile:!0,cb:o},this._sendPacket(t),this)},g.prototype.end=function(){var t=this,e=arguments[0],r=arguments[1],n=arguments[2];function i(){t.disconnected=!0,t.incomingStore.close(function(){t.outgoingStore.close(function(){n&&n.apply(null,arguments),t.emit("end")})}),t._deferredReconnect&&t._deferredReconnect()}function o(){t._cleanUp(e,h.bind(null,i),r)}return null!=e&&"boolean"==typeof e||(n=r||y,r=e,e=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n&&(n=y))),"object"!=typeof r&&(n=r,r=null),n=n||y,this.disconnecting?this:(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?this.once("outgoingEmpty",setTimeout.bind(null,o,10)):o(),this)},g.prototype.removeOutgoingMessage=function(t){var e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},function(){e(new Error("Message removed"))}),this},g.prototype.reconnect=function(t){var e=this,r=function(){t?(e.options.incomingStore=t.incomingStore,e.options.outgoingStore=t.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new o,e.outgoingStore=e.options.outgoingStore||new o,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},g.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},g.prototype._setupReconnect=function(){var t=this;!t.disconnecting&&!t.reconnectTimer&&t.options.reconnectPeriod>0&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),t.reconnectTimer=setInterval(function(){t._reconnect()},t.options.reconnectPeriod))},g.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},g.prototype._cleanUp=function(t,e){var r=arguments[2];if(e&&this.stream.on("close",e),t)0===this.options.reconnectPeriod&&this.options.clean&&function(t){t&&Object.keys(t).forEach(function(e){"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])})}(this.outgoing),this.stream.destroy();else{var n=f({cmd:"disconnect"},r);this._sendPacket(n,h.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(this.stream.removeListener("close",e),e())},g.prototype._sendPacket=function(t,e,r){if(r=r||y,this.connected){switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":return void v(this,t,e,r);default:return void m(this,t,e)}switch(t.qos){case 2:case 1:v(this,t,e,r);break;case 0:default:m(this,t,e)}}else this._storePacket(t,e,r)},g.prototype._storePacket=function(t,e,r){r=r||y,0===(t.qos||0)&&this.queueQoSZero||"publish"!==t.cmd?this.queue.push({packet:t,cb:e}):t.qos>0?(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoingStore.put(t,function(t){if(t)return e&&e(t);r()})):e&&e(new Error("No connection to broker"))},g.prototype._setupPingTimer=function(){var t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=c(function(){t._checkPing()},1e3*this.options.keepalive))},g.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},g.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},g.prototype._handlePingresp=function(){this.pingResp=!0},g.prototype._handleConnack=function(t){var e=this.options,r=5===e.protocolVersion?t.reasonCode:t.returnCode;if(clearTimeout(this.connackTimer),t.properties&&(t.properties.topicAliasMaximum&&(e.properties||(e.properties={}),e.properties.topicAliasMaximum=t.properties.topicAliasMaximum),t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(t);else if(r>0){var n=new Error("Connection refused: "+d[r]);n.code=r,this.emit("error",n)}},g.prototype._handlePublish=function(t,e){e=void 0!==e?e:y;var r=t.topic.toString(),n=t.payload,i=t.qos,o=t.messageId,s=this,a=this.options,u=[0,16,128,131,135,144,145,151,153];switch(i){case 2:a.customHandleAcks(r,n,t,function(r,n){return r instanceof Error||(n=r,r=null),r?s.emit("error",r):-1===u.indexOf(n)?s.emit("error",new Error("Wrong reason code for pubrec")):void(n?s._sendPacket({cmd:"pubrec",messageId:o,reasonCode:n},e):s.incomingStore.put(t,function(){s._sendPacket({cmd:"pubrec",messageId:o},e)}))});break;case 1:a.customHandleAcks(r,n,t,function(i,a){return i instanceof Error||(a=i,i=null),i?s.emit("error",i):-1===u.indexOf(a)?s.emit("error",new Error("Wrong reason code for puback")):(a||s.emit("message",r,n,t),void s.handleMessage(t,function(t){if(t)return e&&e(t);s._sendPacket({cmd:"puback",messageId:o,reasonCode:a},e)}))});break;case 0:this.emit("message",r,n,t),this.handleMessage(t,e)}},g.prototype.handleMessage=function(t,e){e()},g.prototype._handleAck=function(t){var e,r=t.messageId,n=t.cmd,i=null,o=this.outgoing[r]?this.outgoing[r].cb:null,s=this;if(o){switch(n){case"pubcomp":case"puback":var a=t.reasonCode;a&&a>0&&16!==a&&((e=new Error("Publish error: "+d[a])).code=a,o(e,t)),delete this.outgoing[r],this.outgoingStore.del(t,o);break;case"pubrec":i={cmd:"pubrel",qos:2,messageId:r};var u=t.reasonCode;u&&u>0&&16!==u?((e=new Error("Publish error: "+d[u])).code=u,o(e,t)):this._sendPacket(i);break;case"suback":delete this.outgoing[r];for(var c=0;c<t.granted.length;c++)if(0!=(128&t.granted[c])){var l=this.messageIdToTopic[r];l&&l.forEach(function(t){delete s._resubscribeTopics[t]})}o(null,t);break;case"unsuback":delete this.outgoing[r],o(null);break;default:s.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},g.prototype._handlePubrel=function(t,e){e=void 0!==e?e:y;var r=this,n={cmd:"pubcomp",messageId:t.messageId};r.incomingStore.get(t,function(t,i){t?r._sendPacket(n,e):(r.emit("message",i.topic,i.payload,i),r.handleMessage(i,function(t){if(t)return e(t);r.incomingStore.del(i,y),r._sendPacket(n,e)}))})},g.prototype._handleDisconnect=function(t){this.emit("disconnect",t)},g.prototype._nextId=function(){var t=this.nextId++;return 65536===this.nextId&&(this.nextId=1),t},g.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},g.prototype._resubscribe=function(t){var e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!t.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<e.length;r++){var n={};n[e[r]]=this._resubscribeTopics[e[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[e[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},g.prototype._onConnect=function(t){if(this.disconnected)this.emit("connect",t);else{var e=this;this._setupPingTimer(),this._resubscribe(t),this.connected=!0,function r(){var n=e.outgoingStore.createStream();function i(){e._storeProcessing=!1,e._packetIdsDuringStoreProcessing={}}function o(){n.destroy(),n=null,i()}e.once("close",o),n.on("error",function(t){i(),e.removeListener("close",o),e.emit("error",t)}),n.on("end",function(){var n=!0;for(var s in e._packetIdsDuringStoreProcessing)if(!e._packetIdsDuringStoreProcessing[s]){n=!1;break}n?(i(),e.removeListener("close",o),e.emit("connect",t)):r()}),function t(){if(n){e._storeProcessing=!0;var r,i=n.read(1);i?e._packetIdsDuringStoreProcessing[i.messageId]?t():e.disconnecting||e.reconnectTimer?n.destroy&&n.destroy():(r=e.outgoing[i.messageId]?e.outgoing[i.messageId].cb:null,e.outgoing[i.messageId]={volatile:!1,cb:function(e,n){r&&r(e,n),t()}},e._packetIdsDuringStoreProcessing[i.messageId]=!0,e._sendPacket(i)):n.once("readable",t)}}()}()}},t.exports=g}).call(this,r(6),r(7))},function(t,e){e.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[r+p]=255&s,p+=d,s/=256,c-=8);t[r+p-d]|=128*m}},function(t,e){},function(t,e,r){"use strict";var n=r(20).Buffer,i=r(104);function o(t,e,r){t.copy(e,r)}t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e=n.allocUnsafe(t>>>0),r=this.head,i=0;r;)o(r.data,e,i),i+=r.data.length,r=r.next;return e},t}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,r){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},r(106),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(6))},function(t,e,r){(function(t,e){!function(t,r){"use strict";if(!t.setImmediate){var n,i=1,o={},s=!1,a=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){l(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?function(){var e="setImmediate$"+Math.random()+"$",r=function(r){r.source===t&&"string"==typeof r.data&&0===r.data.indexOf(e)&&l(+r.data.slice(e.length))};t.addEventListener?t.addEventListener("message",r,!1):t.attachEvent("onmessage",r),n=function(r){t.postMessage(e+r,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},n=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;n=function(e){var r=a.createElement("script");r.onreadystatechange=function(){l(e),r.onreadystatechange=null,t.removeChild(r),r=null},t.appendChild(r)}}():n=function(t){setTimeout(l,0,t)},u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var s={callback:t,args:e};return o[i]=s,n(i),i++},u.clearImmediate=c}function c(t){delete o[t]}function l(t){if(s)setTimeout(l,0,t);else{var e=o[t];if(e){s=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(r,n)}}(e)}finally{c(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,r(6),r(7))},function(t,e,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(t){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(t,e){if(r("noDeprecation"))return t;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(e);r("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this,r(6))},function(t,e,r){"use strict";t.exports=o;var n=r(49),i=r(21);function o(t){if(!(this instanceof o))return new o(t);n.call(this,t)}i.inherits=r(8),i.inherits(o,n),o.prototype._transform=function(t,e,r){r(null,t)}},function(t,e,r){"use strict";t.exports=r(110)()?Map:r(111)},function(t,e,r){"use strict";t.exports=function(){var t,e;if("function"!=typeof Map)return!1;try{t=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(t){return!1}return"[object Map]"===String(t)&&(3===t.size&&("function"==typeof t.clear&&("function"==typeof t.delete&&("function"==typeof t.entries&&("function"==typeof t.forEach&&("function"==typeof t.get&&("function"==typeof t.has&&("function"==typeof t.keys&&("function"==typeof t.set&&("function"==typeof t.values&&(!1===(e=t.entries().next()).done&&(!!e.value&&("raz"===e.value[0]&&"one"===e.value[1])))))))))))))}},function(t,e,r){"use strict";var n,i=r(50),o=r(112),s=r(25),a=r(13),u=r(9),c=r(14),l=r(131),f=r(10),h=r(58),p=r(137),d=r(155),m=r(158),v=Function.prototype.call,y=Object.defineProperties,g=Object.getPrototypeOf;t.exports=n=function(){var t,e,r,i=arguments[0];if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");return r=m&&s&&Map!==n?s(new Map,g(this)):this,null!=i&&h(i),y(r,{__mapKeysData__:c("c",t=[]),__mapValuesData__:c("c",e=[])}),i?(p(i,function(r){var n=u(r)[0];r=r[1],-1===o.call(t,n)&&(t.push(n),e.push(r))},r),r):r},m&&(s&&s(n,Map),n.prototype=Object.create(Map.prototype,{constructor:c(n)})),l(y(n.prototype,{clear:c(function(){this.__mapKeysData__.length&&(i.call(this.__mapKeysData__),i.call(this.__mapValuesData__),this.emit("_clear"))}),delete:c(function(t){var e=o.call(this.__mapKeysData__,t);return-1!==e&&(this.__mapKeysData__.splice(e,1),this.__mapValuesData__.splice(e,1),this.emit("_delete",e,t),!0)}),entries:c(function(){return new d(this,"key+value")}),forEach:c(function(t){var e,r,n=arguments[1];for(a(t),r=(e=this.entries())._next();void 0!==r;)v.call(t,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=e._next()}),get:c(function(t){var e=o.call(this.__mapKeysData__,t);if(-1!==e)return this.__mapValuesData__[e]}),has:c(function(t){return-1!==o.call(this.__mapKeysData__,t)}),keys:c(function(){return new d(this,"key")}),set:c(function(t,e){var r,n=o.call(this.__mapKeysData__,t);return-1===n&&(n=this.__mapKeysData__.push(t)-1,r=!0),this.__mapValuesData__[n]=e,r&&this.emit("_add",n,t),this}),size:c.gs(function(){return this.__mapKeysData__.length}),values:c(function(){return new d(this,"value")}),toString:c(function(){return"[object Map]"})})),Object.defineProperty(n.prototype,f.iterator,c(function(){return this.entries()})),Object.defineProperty(n.prototype,f.toStringTag,c("c","Map"))},function(t,e,r){"use strict";var n=r(113),i=r(52),o=r(9),s=Array.prototype.indexOf,a=Object.prototype.hasOwnProperty,u=Math.abs,c=Math.floor;t.exports=function(t){var e,r,l,f;if(!n(t))return s.apply(this,arguments);for(r=i(o(this).length),l=arguments[1],e=l=isNaN(l)?0:l>=0?c(l):i(this.length)-c(u(l));e<r;++e)if(a.call(this,e)&&(f=this[e],n(f)))return e;return-1}},function(t,e,r){"use strict";t.exports=r(114)()?Number.isNaN:r(115)},function(t,e,r){"use strict";t.exports=function(){var t=Number.isNaN;return"function"==typeof t&&(!t({})&&t(NaN)&&!t(34))}},function(t,e,r){"use strict";t.exports=function(t){return t!=t}},function(t,e,r){"use strict";var n=r(117),i=Math.abs,o=Math.floor;t.exports=function(t){return isNaN(t)?0:0!==(t=Number(t))&&isFinite(t)?n(t)*o(i(t)):t}},function(t,e,r){"use strict";t.exports=r(118)()?Math.sign:r(119)},function(t,e,r){"use strict";t.exports=function(){var t=Math.sign;return"function"==typeof t&&(1===t(10)&&-1===t(-20))}},function(t,e,r){"use strict";t.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},function(t,e,r){"use strict";var n=r(16),i={function:!0,object:!0};t.exports=function(t){return n(t)&&i[typeof t]||!1}},function(t,e,r){"use strict";var n,i=Object.create;r(53)()||(n=r(54)),t.exports=function(){var t,e,r;return n?1!==n.level?i:(t={},e={},r={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(t){e[t]="__proto__"!==t?r:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(t,e),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:t}),function(e,r){return i(null===e?t:e,r)}):i}()},function(t,e,r){"use strict";var n=r(123);t.exports=function(t){if("function"!=typeof t)return!1;if(!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length)return!1;if("function"!=typeof t.call)return!1;if("function"!=typeof t.apply)return!1}catch(t){return!1}return!n(t)}},function(t,e,r){"use strict";var n=r(31);t.exports=function(t){if(!n(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(t){return!1}}},function(t,e,r){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,r){"use strict";var n=r(126),i=r(9),o=Math.max;t.exports=function(t,e){var r,s,a,u=o(arguments.length,2);for(t=Object(i(t)),a=function(n){try{t[n]=e[n]}catch(t){r||(r=t)}},s=1;s<u;++s)e=arguments[s],n(e).forEach(a);if(void 0!==r)throw r;return t}},function(t,e,r){"use strict";t.exports=r(127)()?Object.keys:r(128)},function(t,e,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,r){"use strict";var n=r(16),i=Object.keys;t.exports=function(t){return i(n(t)?Object(t):t)}},function(t,e,r){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},function(t,e,r){"use strict";var n=String.prototype.indexOf;t.exports=function(t){return n.call(this,t,arguments[1])>-1}},function(t,e,r){"use strict";var n,i,o,s,a,u,c,l=r(14),f=r(13),h=Function.prototype.apply,p=Function.prototype.call,d=Object.create,m=Object.defineProperty,v=Object.defineProperties,y=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};a={on:n=function(t,e){var r;return f(e),y.call(this,"__ee__")?r=this.__ee__:(r=g.value=d(null),m(this,"__ee__",g),g.value=null),r[t]?"object"==typeof r[t]?r[t].push(e):r[t]=[r[t],e]:r[t]=e,this},once:i=function(t,e){var r,i;return f(e),i=this,n.call(this,t,r=function(){o.call(i,t,r),h.call(e,this,arguments)}),r.__eeOnceListener__=e,this},off:o=function(t,e){var r,n,i,o;if(f(e),!y.call(this,"__ee__"))return this;if(!(r=this.__ee__)[t])return this;if("object"==typeof(n=r[t]))for(o=0;i=n[o];++o)i!==e&&i.__eeOnceListener__!==e||(2===n.length?r[t]=n[o?0:1]:n.splice(o,1));else n!==e&&n.__eeOnceListener__!==e||delete r[t];return this},emit:s=function(t){var e,r,n,i,o;if(y.call(this,"__ee__")&&(i=this.__ee__[t]))if("object"==typeof i){for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];for(i=i.slice(),e=0;n=i[e];++e)h.call(n,this,o)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];h.call(i,this,o)}}},u={on:l(n),once:l(i),off:l(o),emit:l(s)},c=v({},u),t.exports=e=function(t){return null==t?d(c):v(Object(t),u)},e.methods=a},function(t,e,r){"use strict";var n={object:!0,symbol:!0};t.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(t){return!1}return!!n[typeof Symbol.iterator]&&(!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag])}},function(t,e,r){"use strict";var n,i,o,s,a=r(14),u=r(134),c=Object.create,l=Object.defineProperties,f=Object.defineProperty,h=Object.prototype,p=c(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),s=!0}catch(t){}}var d=function(){var t=c(null);return function(e){for(var r,n,i=0;t[e+(i||"")];)++i;return t[e+=i||""]=!0,f(h,r="@@"+e,a.gs(null,function(t){n||(n=!0,f(this,r,a(t)),n=!1)})),r}}();o=function(t){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return i(t)},t.exports=i=function t(e){var r;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return s?n(e):(r=c(o.prototype),e=void 0===e?"":String(e),l(r,{__description__:a("",e),__name__:a("",d(e))}))},l(i,{for:a(function(t){return p[t]?p[t]:p[t]=i(String(t))}),keyFor:a(function(t){var e;for(e in u(t),p)if(p[e]===t)return e}),hasInstance:a("",n&&n.hasInstance||i("hasInstance")),isConcatSpreadable:a("",n&&n.isConcatSpreadable||i("isConcatSpreadable")),iterator:a("",n&&n.iterator||i("iterator")),match:a("",n&&n.match||i("match")),replace:a("",n&&n.replace||i("replace")),search:a("",n&&n.search||i("search")),species:a("",n&&n.species||i("species")),split:a("",n&&n.split||i("split")),toPrimitive:a("",n&&n.toPrimitive||i("toPrimitive")),toStringTag:a("",n&&n.toStringTag||i("toStringTag")),unscopables:a("",n&&n.unscopables||i("unscopables"))}),l(o.prototype,{constructor:a(i),toString:a("",function(){return this.__name__})}),l(i.prototype,{toString:a(function(){return"Symbol ("+u(this).__description__+")"}),valueOf:a(function(){return u(this)})}),f(i.prototype,i.toPrimitive,a("",function(){var t=u(this);return"symbol"==typeof t?t:t.toString()})),f(i.prototype,i.toStringTag,a("c","Symbol")),f(o.prototype,i.toStringTag,a("c",i.prototype[i.toStringTag])),f(o.prototype,i.toPrimitive,a("c",i.prototype[i.toPrimitive]))},function(t,e,r){"use strict";var n=r(135);t.exports=function(t){if(!n(t))throw new TypeError(t+" is not a symbol");return t}},function(t,e,r){"use strict";t.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&("Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag]))}},function(t,e,r){"use strict";var n=r(26),i=r(16),o=r(27),s=r(10).iterator,a=Array.isArray;t.exports=function(t){return!!i(t)&&(!!a(t)||(!!o(t)||(!!n(t)||"function"==typeof t[s])))}},function(t,e,r){"use strict";var n=r(26),i=r(13),o=r(27),s=r(138),a=Array.isArray,u=Function.prototype.call,c=Array.prototype.some;t.exports=function(t,e){var r,l,f,h,p,d,m,v,y=arguments[2];if(a(t)||n(t)?r="array":o(t)?r="string":t=s(t),i(e),f=function(){h=!0},"array"!==r)if("string"!==r)for(l=t.next();!l.done;){if(u.call(e,y,l.value,f),h)return;l=t.next()}else for(d=t.length,p=0;p<d&&(m=t[p],p+1<d&&(v=m.charCodeAt(0))>=55296&&v<=56319&&(m+=t[++p]),u.call(e,y,m,f),!h);++p);else c.call(t,function(t){return u.call(e,y,t,f),h})}},function(t,e,r){"use strict";var n=r(26),i=r(27),o=r(139),s=r(154),a=r(58),u=r(10).iterator;t.exports=function(t){return"function"==typeof a(t)[u]?t[u]():n(t)?new o(t):i(t)?new s(t):new o(t)}},function(t,e,r){"use strict";var n,i=r(25),o=r(57),s=r(14),a=r(10),u=r(33),c=Object.defineProperty;n=t.exports=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");u.call(this,t),e=e?o.call(e,"key+value")?"key+value":o.call(e,"key")?"key":"value":"value",c(this,"__kind__",s("",e))},i&&i(n,u),delete n.prototype.constructor,n.prototype=Object.create(u.prototype,{_resolve:s(function(t){return"value"===this.__kind__?this.__list__[t]:"key+value"===this.__kind__?[t,this.__list__[t]]:t})}),c(n.prototype,a.toStringTag,s("c","Array Iterator"))},function(t,e,r){"use strict";var n,i=r(17),o=r(141),s=r(145),a=r(146),u=r(56),c=r(151),l=Function.prototype.bind,f=Object.defineProperty,h=Object.prototype.hasOwnProperty;n=function(t,e,r){var n,i=o(e)&&s(e.value);return delete(n=a(e)).writable,delete n.value,n.get=function(){return!r.overwriteDefinition&&h.call(this,t)?i:(e.value=l.call(i,r.resolveContext?r.resolveContext(this):this),f(this,t,e),this[t])},n},t.exports=function(t){var e=u(arguments[1]);return i(e.resolveContext)&&s(e.resolveContext),c(t,function(t,r){return n(r,t,e)})}},function(t,e,r){"use strict";var n=r(59),i=r(17);t.exports=function(t){return i(t)?t:n(t,"Cannot use %v",arguments[1])}},function(t,e,r){"use strict";var n=r(17),i=r(31),o=Object.prototype.toString;t.exports=function(t){if(!n(t))return null;if(i(t)){var e=t.toString;if("function"!=typeof e)return null;if(e===o)return null}try{return""+t}catch(t){return null}}},function(t,e,r){"use strict";var n=r(144),i=/[\n\r\u2028\u2029]/g;t.exports=function(t){var e=n(t);return null===e?"<Non-coercible to string value>":(e.length>100&&(e=e.slice(0,99)+""),e=e.replace(i,function(t){switch(t){case"\n":return"\\n";case"\r":return"\\r";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw new Error("Unexpected character")}}))}},function(t,e,r){"use strict";t.exports=function(t){try{return t.toString()}catch(e){try{return String(t)}catch(t){return null}}}},function(t,e,r){"use strict";var n=r(59),i=r(55);t.exports=function(t){return i(t)?t:n(t,"%v is not a plain function",arguments[1])}},function(t,e,r){"use strict";var n=r(147),i=r(32),o=r(9);t.exports=function(t){var e=Object(o(t)),r=arguments[1],s=Object(arguments[2]);if(e!==t&&!r)return e;var a={};return r?n(r,function(e){(s.ensure||e in t)&&(a[e]=t[e])}):i(a,t),a}},function(t,e,r){"use strict";t.exports=r(148)()?Array.from:r(149)},function(t,e,r){"use strict";t.exports=function(){var t,e,r=Array.from;return"function"==typeof r&&(e=r(t=["raz","dwa"]),Boolean(e&&e!==t&&"dwa"===e[1]))}},function(t,e,r){"use strict";var n=r(10).iterator,i=r(26),o=r(150),s=r(52),a=r(13),u=r(9),c=r(16),l=r(27),f=Array.isArray,h=Function.prototype.call,p={configurable:!0,enumerable:!0,writable:!0,value:null},d=Object.defineProperty;t.exports=function(t){var e,r,m,v,y,g,_,b,w,k,S=arguments[1],E=arguments[2];if(t=Object(u(t)),c(S)&&a(S),this&&this!==Array&&o(this))e=this;else{if(!S){if(i(t))return 1!==(y=t.length)?Array.apply(null,t):((v=new Array(1))[0]=t[0],v);if(f(t)){for(v=new Array(y=t.length),r=0;r<y;++r)v[r]=t[r];return v}}v=[]}if(!f(t))if(void 0!==(w=t[n])){for(_=a(w).call(t),e&&(v=new e),b=_.next(),r=0;!b.done;)k=S?h.call(S,E,b.value,r):b.value,e?(p.value=k,d(v,r,p)):v[r]=k,b=_.next(),++r;y=r}else if(l(t)){for(y=t.length,e&&(v=new e),r=0,m=0;r<y;++r)k=t[r],r+1<y&&(g=k.charCodeAt(0))>=55296&&g<=56319&&(k+=t[++r]),k=S?h.call(S,E,k,m):k,e?(p.value=k,d(v,m,p)):v[m]=k,++m;y=m}if(void 0===y)for(y=s(t.length),e&&(v=new e(y)),r=0;r<y;++r)k=S?h.call(S,E,t[r],r):t[r],e?(p.value=k,d(v,r,p)):v[r]=k;return e&&(p.value=null,v.length=y),v}},function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call(r(51));t.exports=function(t){return"function"==typeof t&&n.call(t)===i}},function(t,e,r){"use strict";var n=r(13),i=r(152),o=Function.prototype.call;t.exports=function(t,e){var r={},s=arguments[2];return n(e),i(t,function(t,n,i,a){r[n]=o.call(e,s,t,n,i,a)}),r}},function(t,e,r){"use strict";t.exports=r(153)("forEach")},function(t,e,r){"use strict";var n=r(13),i=r(9),o=Function.prototype.bind,s=Function.prototype.call,a=Object.keys,u=Object.prototype.propertyIsEnumerable;t.exports=function(t,e){return function(r,c){var l,f=arguments[2],h=arguments[3];return r=Object(i(r)),n(c),l=a(r),h&&l.sort("function"==typeof h?o.call(h,r):void 0),"function"!=typeof t&&(t=l[t]),s.call(t,l,function(t,n){return u.call(r,t)?s.call(c,f,r[t],t,r,n):e})}}},function(t,e,r){"use strict";var n,i=r(25),o=r(14),s=r(10),a=r(33),u=Object.defineProperty;n=t.exports=function(t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");t=String(t),a.call(this,t),u(this,"__length__",o("",t.length))},i&&i(n,a),delete n.prototype.constructor,n.prototype=Object.create(a.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(t){var e,r=this.__list__[t];return this.__nextIndex__===this.__length__?r:(e=r.charCodeAt(0))>=55296&&e<=56319?r+this.__list__[this.__nextIndex__++]:r})}),u(n.prototype,s.toStringTag,o("c","String Iterator"))},function(t,e,r){"use strict";var n,i=r(25),o=r(14),s=r(33),a=r(10).toStringTag,u=r(156),c=Object.defineProperties,l=s.prototype._unBind;n=t.exports=function(t,e){if(!(this instanceof n))return new n(t,e);s.call(this,t.__mapKeysData__,t),e&&u[e]||(e="key+value"),c(this,{__kind__:o("",e),__values__:o("w",t.__mapValuesData__)})},i&&i(n,s),n.prototype=Object.create(s.prototype,{constructor:o(n),_resolve:o(function(t){return"value"===this.__kind__?this.__values__[t]:"key"===this.__kind__?this.__list__[t]:[this.__list__[t],this.__values__[t]]}),_unBind:o(function(){this.__values__=null,l.call(this)}),toString:o(function(){return"[object Map Iterator]"})}),Object.defineProperty(n.prototype,a,o("c","Map Iterator"))},function(t,e,r){"use strict";t.exports=r(157)("key","value","key+value")},function(t,e,r){"use strict";var n=Array.prototype.forEach,i=Object.create;t.exports=function(t){var e=i(null);return n.call(arguments,function(t){e[t]=!0}),e}},function(t,e,r){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},function(t,e,r){"use strict";e.parser=r(160),e.generate=r(166),e.writeToStream=r(61)},function(t,e,r){"use strict";var n=r(161),i=r(8),o=r(18).EventEmitter,s=r(165),a=r(60);function u(t){if(!(this instanceof u))return new u(t);this.settings=t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}i(u,o),u.prototype._resetState=function(){this.packet=new s,this.error=null,this._list=n(),this._stateCounter=0},u.prototype.parse=function(t){for(this.error&&this._resetState(),this._list.append(t);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},u.prototype._parseHeader=function(){var t=this._list.readUInt8(0);return this.packet.cmd=a.types[t>>a.CMD_SHIFT],this.packet.retain=0!=(t&a.RETAIN_MASK),this.packet.qos=t>>a.QOS_SHIFT&a.QOS_MASK,this.packet.dup=0!=(t&a.DUP_MASK),this._list.consume(1),!0},u.prototype._parseLength=function(){var t=this._parseVarByteNum(!0);return t&&(this.packet.length=t.value,this._list.consume(t.bytes)),!!t},u.prototype._parsePayload=function(){var t=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}t=!0}return t},u.prototype._parseConnect=function(){var t,e,r,n,i,o,s={},u=this.packet;if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==t&&"MQIsdp"!==t)return this._emitError(new Error("Invalid protocolId"));if(u.protocolId=t,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(u.protocolVersion=this._list.readUInt8(this._pos),3!==u.protocolVersion&&4!==u.protocolVersion&&5!==u.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.username=this._list.readUInt8(this._pos)&a.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&a.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&a.WILL_FLAG_MASK,s.will&&(u.will={},u.will.retain=0!=(this._list.readUInt8(this._pos)&a.WILL_RETAIN_MASK),u.will.qos=(this._list.readUInt8(this._pos)&a.WILL_QOS_MASK)>>a.WILL_QOS_SHIFT),u.clean=0!=(this._list.readUInt8(this._pos)&a.CLEAN_SESSION_MASK),this._pos++,u.keepalive=this._parseNum(),-1===u.keepalive)return this._emitError(new Error("Packet too short"));if(5===u.protocolVersion){var c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(u.properties=c)}if(null===(e=this._parseString()))return this._emitError(new Error("Packet too short"));if(u.clientId=e,s.will){if(5===u.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(u.will.properties=l)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(u.will.topic=r,null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));u.will.payload=n}if(s.username){if(null===(o=this._parseString()))return this._emitError(new Error("Cannot parse username"));u.username=o}if(s.password){if(null===(i=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));u.password=i}return this.settings=u,u},u.prototype._parseConnack=function(){var t=this.packet;if(this._list.length<2)return null;if(t.sessionPresent=!!(this._list.readUInt8(this._pos++)&a.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?t.reasonCode=this._list.readUInt8(this._pos++):t.returnCode=this._list.readUInt8(this._pos++),-1===t.returnCode||-1===t.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}},u.prototype._parsePublish=function(){var t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));if(!(t.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}t.payload=this._list.slice(this._pos,t.length)}},u.prototype._parseSubscribe=function(){var t,e,r,n,i,o,s,u=this.packet;if(1!==u.qos)return this._emitError(new Error("Wrong subscribe header"));if(u.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(u.properties=c)}for(;this._pos<u.length;){if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse topic"));if(this._pos>=u.length)return this._emitError(new Error("Malformed Subscribe Payload"));r=(e=this._parseByte())&a.SUBSCRIBE_OPTIONS_QOS_MASK,o=0!=(e>>a.SUBSCRIBE_OPTIONS_NL_SHIFT&a.SUBSCRIBE_OPTIONS_NL_MASK),i=0!=(e>>a.SUBSCRIBE_OPTIONS_RAP_SHIFT&a.SUBSCRIBE_OPTIONS_RAP_MASK),n=e>>a.SUBSCRIBE_OPTIONS_RH_SHIFT&a.SUBSCRIBE_OPTIONS_RH_MASK,s={topic:t,qos:r},5===this.settings.protocolVersion&&(s.nl=o,s.rap=i,s.rh=n),u.subscriptions.push(s)}}},u.prototype._parseSuback=function(){var t=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},u.prototype._parseUnsubscribe=function(){var t=this.packet;if(t.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<t.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));t.unsubscriptions.push(r)}}},u.prototype._parseUnsuback=function(){var t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var e=this._parseProperties();for(Object.getOwnPropertyNames(e).length&&(t.properties=e),t.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},u.prototype._parseConfirmation=function(){var t=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&t.length>2){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},u.prototype._parseDisconnect=function(){var t=this.packet;if(5===this.settings.protocolVersion){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},u.prototype._parseAuth=function(){var t=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));t.reasonCode=this._parseByte();var e=this._parseProperties();return Object.getOwnPropertyNames(e).length&&(t.properties=e),!0},u.prototype._parseMessageId=function(){var t=this.packet;return t.messageId=this._parseNum(),null!==t.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},u.prototype._parseString=function(t){var e,r=this._parseNum(),n=r+this._pos;return-1===r||n>this._list.length||n>this.packet.length?null:(e=this._list.toString("utf8",this._pos,n),this._pos+=r,e)},u.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},u.prototype._parseBuffer=function(){var t,e=this._parseNum(),r=e+this._pos;return-1===e||r>this._list.length||r>this.packet.length?null:(t=this._list.slice(this._pos,r),this._pos+=e,t)},u.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var t=this._list.readUInt16BE(this._pos);return this._pos+=2,t},u.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var t=this._list.readUInt32BE(this._pos);return this._pos+=4,t},u.prototype._parseVarByteNum=function(t){for(var e,r=0,n=1,i=0,o=!0,s=this._pos?this._pos:0;r<5&&(i+=n*((e=this._list.readUInt8(s+r++))&a.LENGTH_MASK),n*=128,0!=(e&a.LENGTH_FIN_MASK));)if(this._list.length<=r){o=!1;break}return s&&(this._pos+=r),o=!!o&&(t?{bytes:r,value:i}:i)},u.prototype._parseByte=function(){var t=this._list.readUInt8(this._pos);return this._pos++,t},u.prototype._parseByType=function(t){switch(t){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},u.prototype._parseProperties=function(){for(var t=this._parseVarByteNum(),e=this._pos+t,r={};this._pos<e;){var n=this._parseByte(),i=a.propertiesCodes[n];if(!i)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==i)r[i]?Array.isArray(r[i])?r[i].push(this._parseByType(a.propertiesTypes[i])):(r[i]=[r[i]],r[i].push(this._parseByType(a.propertiesTypes[i]))):r[i]=this._parseByType(a.propertiesTypes[i]);else{r[i]||(r[i]={});var o=this._parseByType(a.propertiesTypes[i]);if(r[i][o.name])if(Array.isArray(r[i][o.name]))r[i][o.name].push(o.value);else{var s=r[i][o.name];r[i][o.name]=[s],r[i][o.name].push(o.value)}else r[i][o.name]=o.value}}return r},u.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new s,this._pos=0,!0},u.prototype._emitError=function(t){this.error=t,this.emit("error",t)},t.exports=u},function(t,e,r){var n=r(162),i=r(163),o=r(20).Buffer;function s(t){if(!(this instanceof s))return new s(t);if(this._bufs=[],this.length=0,"function"==typeof t){this._callback=t;var e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(t){t.on("error",e)}),this.on("unpipe",function(t){t.removeListener("error",e)})}else this.append(t);n.call(this)}i.inherits(s,n),s.prototype._offset=function(t){var e,r=0,n=0;if(0===t)return[0,0];for(;n<this._bufs.length;n++){if(t<(e=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,t-r];r=e}},s.prototype.append=function(t){var e=0;if(o.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof s)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else null!=t&&("number"==typeof t&&(t=t.toString()),this._appendBuffer(o.from(t)));return this},s.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},s.prototype._write=function(t,e,r){this._appendBuffer(t),"function"==typeof r&&r()},s.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},s.prototype.end=function(t){n.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype.get=function(t){return this.slice(t,t+1)[0]},s.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},s.prototype.copy=function(t,e,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return t||o.alloc(0);if(n<=0)return t||o.alloc(0);var i,s,a=!!t,u=this._offset(r),c=n-r,l=c,f=a&&e||0,h=u[1];if(0===r&&n==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:o.concat(this._bufs,this.length);for(s=0;s<this._bufs.length;s++)this._bufs[s].copy(t,f),f+=this._bufs[s].length;return t}if(l<=this._bufs[u[0]].length-h)return a?this._bufs[u[0]].copy(t,e,h,h+l):this._bufs[u[0]].slice(h,h+l);for(a||(t=o.allocUnsafe(c)),s=u[0];s<this._bufs.length;s++){if(!(l>(i=this._bufs[s].length-h))){this._bufs[s].copy(t,f,h,h+l);break}this._bufs[s].copy(t,f,h),f+=i,l-=i,h&&(h=0)}return t},s.prototype.shallowSlice=function(t,e){t=t||0,e=e||this.length,t<0&&(t+=this.length),e<0&&(e+=this.length);var r=this._offset(t),n=this._offset(e),i=this._bufs.slice(r[0],n[0]+1);return 0==n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!=r[1]&&(i[0]=i[0].slice(r[1])),new s(i)},s.prototype.toString=function(t,e,r){return this.slice(e,r).toString(t)},s.prototype.consume=function(t){for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},s.prototype.duplicate=function(){for(var t=0,e=new s;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},s.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in t)!function(e){s.prototype[e]=function(r){return this.slice(r,r+t[e])[e](0)}}(e)}(),t.exports=s},function(t,e,r){t.exports=r(12)},function(t,e,r){(function(t,n){var i=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(a(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(t).replace(i,function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),u=n[r];r<o;u=n[++r])m(u)||!b(u)?s+=" "+u:s+=" "+a(u);return s},e.deprecate=function(r,i){if(g(t.process))return function(){return e.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var o=!1;return function(){if(!o){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),o=!0}return r.apply(this,arguments)}};var o,s={};function a(t,r){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(r)?n.showHidden=r:r&&e._extend(n,r),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),l(n,t,n.depth)}function u(t,e){var r=a.styles[e];return r?"["+a.colors[r][0]+"m"+t+"["+a.colors[r][1]+"m":t}function c(t,e){return t}function l(t,r,n){if(t.customInspect&&r&&S(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return y(i)||(i=l(t,i,n)),i}var o=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(y(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(v(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,r);if(o)return o;var s=Object.keys(r),a=function(t){var e={};return t.forEach(function(t,r){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(r)),k(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(r);if(0===s.length){if(S(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if(_(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(w(r))return t.stylize(Date.prototype.toString.call(r),"date");if(k(r))return f(r)}var c,b="",E=!1,x=["{","}"];(p(r)&&(E=!0,x=["[","]"]),S(r))&&(b=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(b=" "+RegExp.prototype.toString.call(r)),w(r)&&(b=" "+Date.prototype.toUTCString.call(r)),k(r)&&(b=" "+f(r)),0!==s.length||E&&0!=r.length?n<0?_(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),c=E?function(t,e,r,n,i){for(var o=[],s=0,a=e.length;s<a;++s)A(e,String(s))?o.push(h(t,e,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(t,e,r,n,i,!0))}),o}(t,r,n,a,s):s.map(function(e){return h(t,r,n,a,e,E)}),t.seen.pop(),function(t,e,r){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(c,b,x)):x[0]+b+x[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,r,n,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),A(n,i)||(s="["+i+"]"),a||(t.seen.indexOf(u.value)<0?(a=m(r)?l(t,u.value,null):l(t,u.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),g(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function p(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function m(t){return null===t}function v(t){return"number"==typeof t}function y(t){return"string"==typeof t}function g(t){return void 0===t}function _(t){return b(t)&&"[object RegExp]"===E(t)}function b(t){return"object"==typeof t&&null!==t}function w(t){return b(t)&&"[object Date]"===E(t)}function k(t){return b(t)&&("[object Error]"===E(t)||t instanceof Error)}function S(t){return"function"==typeof t}function E(t){return Object.prototype.toString.call(t)}function x(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(o)&&(o=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var r=n.pid;s[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,r,n)}}else s[t]=function(){};return s[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=d,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=_,e.isObject=b,e.isDate=w,e.isError=k,e.isFunction=S,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(164);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function(){var t=new Date,e=[x(t.getHours()),x(t.getMinutes()),x(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=r(8),e._extend=function(t,e){if(!e||!b(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}).call(this,r(6),r(7))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},function(t,e,r){"use strict";var n=r(28).Buffer,i=r(61),o=r(18).EventEmitter;function s(){this._array=new Array(20),this._i=0}r(8)(s,o),s.prototype.write=function(t){return this._array[this._i++]=t,!0},s.prototype.concat=function(){var t,e,r=0,i=new Array(this._array.length),o=this._array,s=0;for(t=0;t<o.length&&void 0!==o[t];t++)"string"!=typeof o[t]?i[t]=o[t].length:i[t]=n.byteLength(o[t]),r+=i[t];for(e=n.allocUnsafe(r),t=0;t<o.length&&void 0!==o[t];t++)"string"!=typeof o[t]?(o[t].copy(e,s),s+=i[t]):(e.write(o[t],s),s+=i[t]);return e},t.exports=function(t,e){var r=new s;return i(t,r,e),r.concat()}},function(t,e,r){"use strict";var n=r(28).Buffer,i=65536,o={};function s(t){var e=n.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(255&t,1),e}t.exports={cache:o,generateCache:function(){for(var t=0;t<i;t++)o[t]=s(t)},generateNumber:s,genBufVariableByteInt:function(t){var e=0,r=0,i=function(t){return t>=0&&t<128?1:t>=128&&t<16384?2:t>=16384&&t<2097152?3:t>=2097152&&t<268435456?4:0}(t),o=n.allocUnsafe(i);do{e=t%128|0,(t=t/128|0)>0&&(e|=128),o.writeUInt8(e,r++)}while(t>0);return{data:o,length:i}},generate4ByteBuffer:function(t){var e=n.allocUnsafe(4);return e.writeUInt32BE(t,0),e}}},function(t,e,r){"use strict";t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new function(t,e,r){var n=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(t){t||(t=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,t,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}(arguments[0],arguments[1],t)}},function(t,e,r){"use strict";function n(t){for(var e=t.split("/"),r=0;r<e.length;r++)if("+"!==e[r]){if("#"===e[r])return r===e.length-1;if(-1!==e[r].indexOf("+")||-1!==e[r].indexOf("#"))return!1}return!0}t.exports={validateTopics:function(t){if(0===t.length)return"empty_topic_list";for(var e=0;e<t.length;e++)if(!n(t[e]))return t[e];return null}}},function(t,e,r){(function(t,n){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var a,u=2147483647,c=36,l=1,f=26,h=38,p=700,d=72,m=128,v="-",y=/^xn--/,g=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=c-l,k=Math.floor,S=String.fromCharCode;function E(t){throw new RangeError(b[t])}function x(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function T(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+x((t=t.replace(_,".")).split("."),e).join(".")}function A(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function I(t){return x(t,function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)}).join("")}function P(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:c}function O(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function C(t,e,r){var n=0;for(t=r?k(t/p):t>>1,t+=k(t/e);t>w*f>>1;n+=c)t=k(t/w);return k(n+(w+1)*t/(t+h))}function R(t){var e,r,n,i,o,s,a,h,p,y,g=[],_=t.length,b=0,w=m,S=d;for((r=t.lastIndexOf(v))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&E("not-basic"),g.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<_;){for(o=b,s=1,a=c;i>=_&&E("invalid-input"),((h=P(t.charCodeAt(i++)))>=c||h>k((u-b)/s))&&E("overflow"),b+=h*s,!(h<(p=a<=S?l:a>=S+f?f:a-S));a+=c)s>k(u/(y=c-p))&&E("overflow"),s*=y;S=C(b-o,e=g.length+1,0==o),k(b/e)>u-w&&E("overflow"),w+=k(b/e),b%=e,g.splice(b++,0,w)}return I(g)}function j(t){var e,r,n,i,o,s,a,h,p,y,g,_,b,w,x,T=[];for(_=(t=A(t)).length,e=m,r=0,o=d,s=0;s<_;++s)(g=t[s])<128&&T.push(S(g));for(n=i=T.length,i&&T.push(v);n<_;){for(a=u,s=0;s<_;++s)(g=t[s])>=e&&g<a&&(a=g);for(a-e>k((u-r)/(b=n+1))&&E("overflow"),r+=(a-e)*b,e=a,s=0;s<_;++s)if((g=t[s])<e&&++r>u&&E("overflow"),g==e){for(h=r,p=c;!(h<(y=p<=o?l:p>=o+f?f:p-o));p+=c)x=h-y,w=c-y,T.push(S(O(y+x%w,0))),h=k(x/w);T.push(S(O(h,0))),o=C(r,b,n==i),r=0,++n}++r,++e}return T.join("")}a={version:"1.4.1",ucs2:{decode:A,encode:I},decode:R,encode:j,toASCII:function(t){return T(t,function(t){return g.test(t)?"xn--"+j(t):t})},toUnicode:function(t){return T(t,function(t){return y.test(t)?R(t.slice(4).toLowerCase()):t})}},void 0===(i=function(){return a}.call(e,r,e,t))||(t.exports=i)}()}).call(this,r(171)(t),r(6))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,r){"use strict";e.decode=e.parse=r(174),e.encode=e.stringify=r(175)},function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,r,o){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=t.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var f,h,p,d,m=t[l].replace(a,"%20"),v=m.indexOf(r);v>=0?(f=m.substr(0,v),h=m.substr(v+1)):(f=m,h=""),p=decodeURIComponent(f),d=decodeURIComponent(h),n(s,p)?i(s[p])?s[p].push(d):s[p]=[s[p],d]:s[p]=d}return s};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,r){"use strict";var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,r,a){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?o(s(t),function(s){var a=encodeURIComponent(n(s))+r;return i(t[s])?o(t[s],function(t){return a+encodeURIComponent(n(t))}).join(e):a+encodeURIComponent(n(t[s]))}).join(e):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},function(t,e){},function(t,e){},function(t,e,r){var n=r(179),i=function(){},o=function(t,e,r){if("function"==typeof e)return o(t,null,e);e||(e={}),r=n(r||i);var s=t._writableState,a=t._readableState,u=e.readable||!1!==e.readable&&t.readable,c=e.writable||!1!==e.writable&&t.writable,l=function(){t.writable||f()},f=function(){c=!1,u||r.call(t)},h=function(){u=!1,c||r.call(t)},p=function(e){r.call(t,e?new Error("exited with error code: "+e):null)},d=function(e){r.call(t,e)},m=function(){return(!u||a&&a.ended)&&(!c||s&&s.ended)?void 0:r.call(t,new Error("premature close"))},v=function(){t.req.on("finish",f)};return!function(t){return t.setHeader&&"function"==typeof t.abort}(t)?c&&!s&&(t.on("end",l),t.on("close",l)):(t.on("complete",f),t.on("abort",m),t.req?v():t.on("request",v)),function(t){return t.stdio&&Array.isArray(t.stdio)&&3===t.stdio.length}(t)&&t.on("exit",p),t.on("end",h),t.on("finish",f),!1!==e.error&&t.on("error",d),t.on("close",m),function(){t.removeListener("complete",f),t.removeListener("abort",m),t.removeListener("request",v),t.req&&t.req.removeListener("finish",f),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",f),t.removeListener("exit",p),t.removeListener("end",h),t.removeListener("error",d),t.removeListener("close",m)}};t.exports=o},function(t,e,r){var n=r(180);function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}t.exports=n(i),t.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},function(t,e){t.exports=function t(e,r){if(e&&r)return t(e)(r);if("function"!=typeof e)throw new TypeError("need wrapper function");Object.keys(e).forEach(function(t){n[t]=e[t]});return n;function n(){for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];var n=e.apply(this,t),i=t[t.length-1];return"function"==typeof n&&n!==i&&Object.keys(i).forEach(function(t){n[t]=i[t]}),n}}},function(t,e){t.exports=function(t){var e=t._readableState;return e?e.objectMode?t.read():t.read(function(t){return t.buffer.length?t.buffer.head?t.buffer.head.data.length:t.buffer[0].length:t.length}(e)):null}},function(t,e,r){"use strict";(function(e,n){var i=r(15).Transform,o=r(35),s=r(183),a=r(184).Buffer;t.exports=function(t,r,u){var c,l,f="browser"===e.title,h=!!n.WebSocket,p=f?function t(e,r,n){if(l.bufferedAmount>m)return void setTimeout(t,v,e,r,n);y&&"string"==typeof e&&(e=a.from(e,"utf8"));try{l.send(e)}catch(t){return n(t)}n()}:function(t,e,r){if(l.readyState!==l.OPEN)return void r();y&&"string"==typeof t&&(t=a.from(t,"utf8"));l.send(t,r)};r&&!Array.isArray(r)&&"object"==typeof r&&(u=r,r=null,("string"==typeof u.protocol||Array.isArray(u.protocol))&&(r=u.protocol));u||(u={});void 0===u.objectMode&&(u.objectMode=!(!0===u.binary||void 0===u.binary));var d=function(t,e,r){var n=new i({objectMode:t.objectMode});return n._write=e,n._flush=r,n}(u,p,function(t){l.close(),t()});u.objectMode||(d._writev=g);var m=u.browserBufferSize||524288,v=u.browserBufferTimeout||1e3;"object"==typeof t?l=t:(l=h&&f?new s(t,r):new s(t,r,u)).binaryType="arraybuffer";l.readyState===l.OPEN?c=d:(c=c=o(void 0,void 0,u),u.objectMode||(c._writev=g),l.onopen=function(){c.setReadable(d),c.setWritable(d),c.emit("connect")});c.socket=l,l.onclose=function(){c.end(),c.destroy()},l.onerror=function(t){c.destroy(t)},l.onmessage=function(t){var e=t.data;e=e instanceof ArrayBuffer?a.from(e):a.from(e,"utf8");d.push(e)},d.on("close",function(){l.close()});var y=!u.objectMode;function g(t,e){for(var r=new Array(t.length),n=0;n<t.length;n++)"string"==typeof t[n].chunk?r[n]=a.from(t[n],"utf8"):r[n]=t[n].chunk;this._write(a.concat(r),"binary",e)}return c}}).call(this,r(7),r(6))},function(t,e){var r=null;"undefined"!=typeof WebSocket?r=WebSocket:"undefined"!=typeof MozWebSocket?r=MozWebSocket:"undefined"!=typeof window&&(r=window.WebSocket||window.MozWebSocket),t.exports=r},function(t,e,r){var n=r(11),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,r){"use strict";r.r(e);var n=r(4),i=r.n(n),o=r(24),s=r.n(o),a=r(36),u=r.n(a),c=r(67),l=r.n(c),f=r(0),h=r.n(f),p=r(1),d=r.n(p),m=r(5),v=r.n(m);var y=function(t){return t=t||Object.create(null),{on:function(e,r){(t[e]||(t[e]=[])).push(r)},off:function(e,r){t[e]&&t[e].splice(t[e].indexOf(r)>>>0,1)},emit:function(e,r){(t[e]||[]).slice().map(function(t){t(r)}),(t["*"]||[]).slice().map(function(t){t(e,r)})}}},g=r(2),_=r.n(g),b=r(22),w=r.n(b),k=r(68),S=r.n(k);function E(t,e,r){return t.split(e).join(r)}function x(t){return E(E(t,"<","&lt;"),">","&gt;")}var T=function(){function t(e){h()(this,t),this.roomAdapter=e,this.name=null,this.emails=[],this.options={}}return d()(t,[{key:"withName",value:function(t){return this.name=t,this}},{key:"withOptions",value:function(t){return this.options=t,this}},{key:"addParticipants",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this.emails=(t=this.emails.filter(function(t){return-1===r.indexOf(t)})).concat.apply(t,r),this}},{key:"create",value:function(){var t=this.name,e=this.emails,r=this.options;return this.roomAdapter.createRoom(t,e,{avatarURL:r.avatarURL},r)}}]),t}();var A=function(){function t(e){h()(this,t),this.id=e.id,this.before_id=e.comment_before_id,this.message=x(e.message),this.username_as=e.username_as||e.username,this.username_real=e.username_real||e.email,this.date=w()(e.timestamp,"YYYY-MM-DD"),this.time=w()(e.timestamp,"HH:mm"),this.timestamp=e.timestamp,this.unique_id=e.unique_temp_id||e.unique_id,this.avatar=e.user_avatar_url,this.room_id=e.room_id,this.isChannel=e.is_public_channel,this.unix_timestamp=e.unix_timestamp,this.is_deleted=e.is_deleted,this.isPending=!1,this.isFailed=!1,this.isDelivered=!1,this.isRead=!1,this.isSent=!1,this.attachment=null,this.payload=e.payload,this.status=e.status,"reply"===e.type&&(e.payload.replied_comment_message=x(e.payload.replied_comment_message),e.payload.text=x(e.payload.text)),this.type=e.type,this.subtype="custom"===e.type?e.payload.type:null,"sent"===e.status?this.markAsSent():"delivered"===e.status?this.markAsDelivered():"read"===e.status&&this.markAsRead()}return d()(t,[{key:"isAttachment",value:function(t){return"[file]"===t.substring(0,"[file]".length)}},{key:"isImageAttachment",value:function(t){return this.isAttachment(t)&&null!=t.match(/\.(jpg|jpeg|gif|png)/i)}},{key:"attachUniqueId",value:function(t){this.unique_id=t}},{key:"getAttachmentURI",value:function(t){if(this.isAttachment(t)){var e=t.length,r="[file]".length,n=e-"[/file]".length;return t.substring(r,n).trim()}}},{key:"setAttachment",value:function(t){this.attachment=t}},{key:"markAsPending",value:function(){this.isPending=!0,this.isDelivered=!1,this.status="pending"}},{key:"markAsSent",value:function(){this.isSent=!0,this.isPending=!1,this.isFailed=!1,this.status="sent"}},{key:"markAsDelivered",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===Object.keys(e).length)return this.isSent=!0,this.isRead=!1,this.isDelivered=!0,void(this.status="delivered");var r=e.participants,n=e.actor,i=e.comment_id,o=e.activeActorId,s=r.find(function(t){return t.email===n});s&&(s.last_comment_received_id=i,s.last_comment_received_id_str=i),0===r.map(function(t){return{commentId:t.last_comment_received_id,userId:t.email}}).filter(function(t){return t.userId!==o}).filter(function(e){return e.commentId<t.id}).length&&(this.isSent=!0,this.isRead=!1,this.isDelivered=!0,this.status="delivered")}},{key:"markAsRead",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===Object.keys(e).length)return this.isPending=!1,this.isSent=!0,this.isDelivered=!0,this.isRead=!0,void(this.status="read");var r=e.participants,n=e.actor,i=e.comment_id,o=e.activeActorId,s=r.find(function(t){return t.email===n});(null!=s&&(s.last_comment_read_id=i,s.last_comment_read_id_str=i.toString(),s.last_comment_received_id=i,s.last_comment_received_id_str=i.toString()),o!==n)&&(0===r.map(function(t){return{commentId:t.last_comment_read_id,userId:t.email}}).filter(function(t){return t.userId!==e.activeActorId}).filter(function(e){return e.commentId<t.id}).length&&(this.isPending=!1,this.isSent=!0,this.isDelivered=!0,this.isRead=!0,this.status="read"))}},{key:"markAsFailed",value:function(){this.isFailed=!0,this.isPending=!1,this.isStatus="failed"}},{key:"update",value:function(t){this.id=t.id,this.before_id=t.comment_before_id,this.message=x(t.message),t.payload&&(this.payload=t.payload),t.status&&(this.status=t.status),"reply"===t.type&&(this.payload.replied_comment_message=x(t.payload.replied_comment_message),this.payload.text=x(t.payload.text)),"sent"===t.status?this.markAsSent():"delivered"===t.status?this.markAsDelivered():"read"===t.status&&this.markAsRead()}}]),t}(),I=function(){function t(e){h()(this,t),this.id=e.id,this.last_comment_id=e.last_comment_id,this.last_comment_message=e.last_comment_message,this.last_comment_message_created_at=e.last_comment_message_created_at,this.last_comment_topic_title=e.last_comment_topic_title,this.avatar=e.room_avatar||e.avatarURL||e.avatar_url,this.name=e.room_name,this.room_type=e.room_type||e.chat_type,this.secret_code=e.secret_code,this.participants=e.participants,this.options=e.options,this.topics=[],this.comments=[],this.count_notif=e.unread_count,this.isLoaded=!1,this.unread_comments=[],this.custom_title=null,this.custom_subtitle=null,this.options=e.options,this.unique_id=e.unique_id,this.isChannel=e.is_public_channel,this.participantNumber=e.room_total_participants,e.comments&&this.receiveComments(e.comments)}return d()(t,[{key:"isCurrentlySelected",value:function(t){return this.id===t.id}},{key:"getParticipantCount",value:function(){return null==this.participants?this.participantNumber:this.participants.length}},{key:"setTitle",value:function(t){this.custom_title=t}},{key:"setSubTitle",value:function(t){this.custom_subtitle=t}},{key:"receiveComment",value:function(t){if(t.room_id===this.id){var e=this.comments.find(function(e){return e.unique_id===t.unique_id});e?(e.id=t.id,e.message=t.message,e.date=t.date,e.time=t.time,e.unix_timestamp=t.unix_timestamp):this.comments.push(t)}}},{key:"receiveComments",value:function(t){var e=this;t.forEach(function(t){e.receiveComment(new A(t))})}},{key:"getParticipant",value:function(t){return this.participants.find(function(e){return e.email===t})||null}},{key:"addParticipant",value:function(t){this.getParticipant(t.email)||this.participants.push(t)}}]),t}(),P=function(){function t(e){var r=e.baseURL,n=e.AppId,i=e.userId,o=e.version;h()(this,t),this.baseURL=r,this.token=null,this.userId=i,this.AppId=n,this.version=o}return d()(t,[{key:"setToken",value:function(t){this.token=t}},{key:"get",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return new Promise(function(i,o){var s=v.a.get("".concat(e.baseURL,"/").concat(t));n&&n.baseURL&&(s=v.a.get("".concat(n.baseURL,"/").concat(t))),(s=e.setupHeaders(s,r)).end(function(t,e){return t?o(t):i(e)})})}},{key:"get_request",value:function(t){var e=v.a.get("".concat(this.baseURL,"/").concat(t));return e=this.setupHeaders(e,{})}},{key:"post",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,o){var s=v.a.post("".concat(e.baseURL,"/").concat(t));(s=e.setupHeaders(s,n)).send(r).set("Content-Type","application/x-www-form-urlencoded").end(function(t,e){return t?o(t):i(e)})})}},{key:"post_json",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,o){var s=v.a.post("".concat(e.baseURL,"/").concat(t));(s=e.setupHeaders(s,n)).send(r).set("Content-Type","application/json").end(function(t,e){return t?o(t):i(e)})})}},{key:"put",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,o){var s=v.a.put("".concat(e.baseURL,"/").concat(t));(s=e.setupHeaders(s,n)).send(r).set("Content-Type","application/x-www-form-urlencoded").end(function(t,e){return t?o(t):i(e)})})}},{key:"patch",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,o){var s=v.a.patch("".concat(e.baseURL,"/").concat(t));(s=e.setupHeaders(s,n)).send(r).set("Content-Type","application/x-www-form-urlencoded").end(function(t,e){return t?o(t):i(e)})})}},{key:"del",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,o){var s=v.a.del("".concat(e.baseURL,"/").concat(t));(s=e.setupHeaders(s,n)).send(r).set("Content-Type","application/json").end(function(t,e){return t?o(t):i(e)})})}},{key:"setupHeaders",value:function(t,e){if(t.set("QISCUS_SDK_APP_ID","".concat(this.AppId)),t.set("QISCUS_SDK_USER_ID","".concat(this.userId)),t.set("QISCUS_SDK_TOKEN","".concat(this.token)),t.set("QISCUS_SDK_VERSION","".concat(this.version)),Object.keys(e).length<1)return t;for(var r in e)t.set(r,e[r]);return t}}]),t}(),O=function(){function t(e){h()(this,t),this.HTTPAdapter=e,this.token=e.token}return d()(t,[{key:"getNonce",value:function(){return this.HTTPAdapter.post("api/v2/sdk/auth/nonce").then(function(t){return Promise.resolve(t.body.results)},function(t){return Promise.reject(t)})}},{key:"loginOrRegister",value:function(t){return this.HTTPAdapter.post("api/v2/sdk/login_or_register",t).then(function(t){return new Promise(function(e,r){return 200!==t.body.status?r(t):e(t.body.results)})},function(t){return Promise.reject(t)})}},{key:"verifyIdentityToken",value:function(t){return this.HTTPAdapter.post("api/v2/sdk/auth/verify_identity_token",{identity_token:t}).then(function(t){return Promise.resolve(t.body.results)},function(t){return Promise.reject(t)})}}]),t}(),C=r(23),R=r.n(C),j=function(){function t(e){var r=this;h()(this,t),i()(this,"updateCommentStatus",R()(function(t,e,n){var i={token:r.token,room_id:t};return e&&(i.last_comment_read_id=e),n&&(i.last_comment_received_id=n),r.HTTPAdapter.post("api/v2/mobile/update_comment_status",i).then(function(t){return Promise.resolve(t)}).catch(function(t){return console.log(t)})},300)),this.HTTPAdapter=e,this.token=e.token}return d()(t,[{key:"postComment",value:function(t,e,r,n,i,o){return this.HTTPAdapter.post("api/v2/sdk/post_comment",{token:this.token,comment:e,topic_id:t,unique_temp_id:r,type:n,payload:i,extras:o}).then(function(t){return new Promise(function(e,r){return 200!==t.body.status?r(t):e(t.body.results.comment)})},function(t){return Promise.reject(t)})}},{key:"sync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.HTTPAdapter.get("api/v2/sdk/sync?token=".concat(this.token,"&last_received_comment_id=").concat(t)).then(function(t,e){return e?Promise.reject(e):new Promise(function(e,r){return 200!==t.body.status?r(t):e(t.body.results.comments)})}).catch(function(t){return console.log(t)})}},{key:"syncEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.HTTPAdapter.get("api/v2/sdk/sync_event?token=".concat(this.token,"&start_event_id=").concat(t)).then(function(t,e){return e?Promise.reject(e):new Promise(function(e,r){return 200!==t.statusCode?r(t):e(t.body)})}).catch(function(t){return console.log(t)})}},{key:"loadRoomList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="?token=".concat(this.token);return t.page&&(e+="&page=".concat(t.page)),t.show_participants&&(e+="&show_participants=".concat(t.show_participants||!0)),t.limit&&(e+="&limit=".concat(t.limit)),t.show_empty&&(e+="&show_empty=".concat(t.show_empty)),this.HTTPAdapter.get("api/v2/sdk/user_rooms".concat(e)).then(function(t){return new Promise(function(e,r){return 200!==t.body.status?r(t):e(t.body.results.rooms_info)})},function(t){return Promise.reject(t)})}},{key:"searchMessages",value:function(t){var e={token:this.token,query:t.query||null,room_id:t.room_id||null,last_comment_id:t.last_comment_id||null};return this.HTTPAdapter.post("api/v2/sdk/search_messages",e).then(function(t){return Promise.resolve(t.body.results.comments)}).catch(function(t){return Promise.reject(t)})}},{key:"updateProfile",value:function(t){var e={token:this.token,name:t.name||null,avatar_url:t.avatar_url||null,extras:t.extra?JSON.stringify(t.extras):null};return this.HTTPAdapter.patch("api/v2/sdk/my_profile",e).then(function(t){return Promise.resolve(t.body.results.user)}).catch(function(t){return Promise.reject(t)})}},{key:"uploadFile",value:function(t){var e={token:this.token,file:t};return this.HTTPAdapter.post("api/v2/sdk/upload",e).then(function(t){return Promise.resolve(t.body)}).catch(function(t){return Promise.reject(t)})}},{key:"getRoomsInfo",value:function(t){var e={token:this.token,show_participants:!0,show_removed:!1};return t.room_ids&&(e.room_id=t.room_ids),t.room_unique_ids&&(e.room_unique_id=t.room_unique_ids),t.show_participants&&(e.show_participants=t.show_participants),t.show_removed&&(e.show_removed=t.show_removed),this.HTTPAdapter.post_json("api/v2/mobile/rooms_info",e).then(function(t){return Promise.resolve(t.body)}).catch(function(t){return Promise.reject(t)})}},{key:"loadComments",value:function(t,e){var r="token=".concat(this.token,"&topic_id=").concat(t);return e.last_comment_id&&(r+="&last_comment_id=".concat(e.last_comment_id)),e.timestamp&&(r+="&timestamp=".concat(e.timestamp)),e.after&&(r+="&after=".concat(e.after)),e.limit&&(r+="&limit=".concat(e.limit)),this.HTTPAdapter.get("api/v2/sdk/load_comments?".concat(r)).then(function(t){return new Promise(function(e,r){return 200!==t.status?new Promise(function(e,r){return r(t)}):e(t.body.results.comments)})},function(t){return new Promise(function(e,r){return r(t)})})}},{key:"deleteComment",value:function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!1===r&&console.warn("Deprecated: delete comment for me will be removed on next release"),!1===n&&console.warn("Deprecated: soft delete will be removed on next release");var i={token:this.token,unique_ids:e,is_delete_for_everyone:r,is_hard_delete:n};return this.HTTPAdapter.del("api/v2/sdk/delete_messages",i).then(function(t){return Promise.resolve(t.body)}).catch(function(t){return Promise.reject(t)})}},{key:"clearRoomMessages",value:function(t){var e={token:this.token,room_channel_ids:t};return this.HTTPAdapter.del("api/v2/sdk/clear_room_messages",e).then(function(t){return Promise.resolve(t.body)}).catch(function(t){return Promise.reject(t)})}},{key:"getCommentReceiptStatus",value:function(t){return this.HTTPAdapter.get("api/v2/sdk/comment_receipt?token=".concat(this.token,"&comment_id=").concat(t)).then(function(t){return Promise.resolve(t.body)}).catch(function(t){return Promise.reject(t)})}},{key:"getBlockedUser",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r="api/v2/mobile/get_blocked_users?token=".concat(this.token,"&page=").concat(t,"&limit=").concat(e);return this.HTTPAdapter.get(r).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.blocked_users)},function(t){return Promise.reject(t)})}},{key:"blockUser",value:function(t){if(!t)throw new Error("email is required");var e={token:this.token,user_email:t};return this.HTTPAdapter.post("api/v2/mobile/block_user",e).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.user)},function(t){return Promise.reject(t)})}},{key:"unblockUser",value:function(t){if(!t)throw new Error("email is required");var e={token:this.token,user_email:t};return this.HTTPAdapter.post("api/v2/mobile/unblock_user",e).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.user)},function(t){return Promise.reject(t)})}}]),t}(),M=function(){function t(e){h()(this,t),this.HTTPAdapter=e,this.token=e.token}return d()(t,[{key:"getOrCreateRoom",value:function(t,e,r){var n={token:this.token,emails:t};return r&&(n[r]=r),e&&(n.options=JSON.stringify(e)),this.HTTPAdapter.post("api/v2/sdk/get_or_create_room_with_target",n).then(function(e){if(200!==e.body.status)return Promise.reject(e);var r=e.body.results.room;r.avatar=r.avatar_url,r.comments=e.body.results.comments.reverse();var n=r.participants.find(function(e){return e.email===t});return r.name=n?n.username:"Room name",Promise.resolve(r)},function(t){return Promise.reject(t)})}},{key:"getRoomById",value:function(t){return this.HTTPAdapter.get("api/v2/mobile/get_room_by_id?token=".concat(this.token,"&id=").concat(t)).then(function(t){return Promise.resolve(t.body)},function(t){return Promise.reject(t)})}},{key:"getOrCreateRoomByUniqueId",value:function(t,e,r){var n={token:this.token,unique_id:t,name:e,avatar_url:r};return this.HTTPAdapter.post("api/v2/mobile/get_or_create_room_with_unique_id",n).then(function(t){if(200!==t.body.status)return Promise.reject(t);var e=t.body.results.room;return e.avatar=e.avatar_url,e.comments=t.body.results.comments.reverse(),e.name=e.room_name,Promise.resolve(e)},function(t){return Promise.reject(t)})}},{key:"createRoom",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=Object.keys(n).length<=0?null:JSON.stringify(n),o={token:this.token,name:t,"participants[]":e,avatar_url:r.avatarURL,options:i};return this.HTTPAdapter.post("api/v2/mobile/create_room",o).then(function(t){if(200!==t.body.status)return Promise.reject(t);var e=t.body.results.room;return e.comments=t.body.results.comments,Promise.resolve({id:e.id,name:e.room_name,lastCommentId:e.last_comment_id,lastCommentMessage:e.last_comment_message,lastTopicId:e.last_topic_id,avatarURL:e.avatar_url,options:e.options,participants:e.participants.map(function(t){return{id:t.id,email:t.email,username:t.username,avatarURL:t.avatar_url}})})}).catch(function(t){return console.error("Error when creating room",t),Promise.reject(new Error("Error when creating room"))})}},{key:"updateRoom",value:function(t){if(!t.id)throw new Error("id is required");var e={token:this.token,id:t.id};return t.room_name&&(e.room_name=t.room_name),t.avatar_url&&(e.avatar_url=t.avatar_url),t.options&&(e.options=JSON.stringify(t.options)),this.HTTPAdapter.post("api/v2/mobile/update_room",e).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.room)},function(t){return Promise.reject(t)})}},{key:"getTotalUnreadCount",value:function(){return this.HTTPAdapter.get("api/v2/sdk/total_unread_count?token=".concat(this.token)).then(function(t){return Promise.resolve(t.body.results.total_unread_count)},function(t){return Promise.reject(t)})}},{key:"addParticipantsToGroup",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||!e)throw new Error("room_id and emails is required");var r={token:this.token,room_id:t,"emails[]":e};return this.HTTPAdapter.post("api/v2/mobile/add_room_participants",r).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.participants_added)},function(t){return Promise.reject(t)})}},{key:"removeParticipantsFromGroup",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||!e)throw new Error("room_id and emails is required");var r={token:this.token,room_id:t,"emails[]":e};return this.HTTPAdapter.post("api/v2/mobile/remove_room_participants",r).then(function(t){return 200!==t.body.status?Promise.reject(t):Promise.resolve(t.body.results.participants_removed)},function(t){return Promise.reject(t)})}}]),t}(),D=r(69),U=r.n(D),L=String("match.pattern.catchAll"),q=String("match.pattern.OR"),N=q.toString(),F=String("match.pattern.AND"),B=F.toString(),H=String("match.pattern.RANGE"),z=H.toString(),Y=String("match.pattern.REGEXP"),W=Y.toString(),K=/\/(.*)\/(.*)/;function $(){Error.call(this,"Missing when() catch-all pattern as last match argument, add [when()]: void 0"),"stack"in this||(this.stack=(new Error).stack)}function V(t){return void 0===t?L:t instanceof RegExp?Q([Y.toString(),t.toString()]):Q(t)}function Q(t){return JSON.stringify([V.__uid++,t])}function G(){return!0}$.prototype=Object.create(Error.prototype),V.__uid=0,V.or=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Q([q.toString(),e])},V.and=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Q([F.toString(),e])},V.range=function(t,e){return Q([H.toString(),t,e])},V.unserialize=function(t,e){if(t===L)return{match:G,result:e,position:1/0};var r=function(t){return JSON.parse(t)}(t),n=r[1],i=r[0];return{match:function(t){if(Array.isArray(t)){if(t[0]===N)return t.shift(),function(e){return t[0].some(function(t){return r(t,e)})};if(t[0]===B)return t.shift(),function(e){return t[0].every(function(t){return r(t,e)})};if(t[0]===z)return t.shift(),function(e){return t[0]<=e&&e<=t[1]};if(t[0]===W){var e=K.exec(t[1]);return r.bind(null,new RegExp(e[1],e[2]))}}function r(t,e){if(Array.isArray(e))return JSON.stringify(t)===JSON.stringify(e);if(t instanceof RegExp)return t.test(e);if("object"===U()(e)){for(var r in t)if(e[r]!==t[r])return!1;return!0}return t===e}return function(e){return r(t,e)}}(n),result:e,position:i}};var X=r(70),J=r.n(X),Z=function(){function t(e,r){var n,o=this;h()(this,t);var s=y(),a=J()(e,{will:{topic:"u/".concat(r.userData.email,"/s"),payload:0,retain:!0}});Object.defineProperties(this,{core:{value:r},emitter:{value:s},mqtt:{value:a}});var u=function(){var t,e=(t=arguments.length-1)<0||arguments.length<=t?void 0:arguments[t],r=[];for(var n in e)r.push(V.unserialize(n,e[n]));r.sort(function(t,e){return t.position<e.position?-1:1}),-1!==Object.getOwnPropertySymbols(e).indexOf(L)&&r.push(V.unserialize(L,e[L]));var i=function(t){var e=r.find(function(e){return e.match(t)});if(!e)throw new $;return"function"==typeof e.result?e.result(t):e.result};return 2===arguments.length?i(arguments.length<=0?void 0:arguments[0]):i}((n={},i()(n,V(this.reNewMessage),function(t){return o.newMessageHandler.bind(o,t)}),i()(n,V(this.reNotification),function(t){return o.notificationHandler.bind(o,t)}),i()(n,V(this.reTyping),function(t){return o.typingHandler.bind(o,t)}),i()(n,V(this.reDelivery),function(t){return o.deliveryReceiptHandler.bind(o,t)}),i()(n,V(this.reRead),function(t){return o.readReceiptHandler.bind(o,t)}),i()(n,V(this.reOnlineStatus),function(t){return o.onlinePresenceHandler.bind(o,t)}),i()(n,V(this.reChannelMessage),function(t){return o.channelMessageHandler.bind(o,t)}),i()(n,V(),function(t){return o.logger("topic not handled",t)}),n));this.mqtt.on("message",function(t,e){var r=e.toString(),n=u(t);null!=n&&n(r)}),this.mqtt.on("connect",function(){o.emit("connected"),o.logger("connect",o.mqtt.connected),"socket"===r.sync&&r.disableSync()}),this.mqtt.on("reconnect",function(){o.logger("reconnect",o.mqtt.connected),o.emit("reconnect"),o.mqtt.connected&&r.disableSync(),r.synchronize(),r.synchronizeEvent()}),this.mqtt.on("close",function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];o.logger("close",e),o.emit("close",o.mqtt),r.activateSync()}),this.mqtt.on("error",function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];o.logger("error",e),o.emit("error"),r.activateSync()})}return d()(t,[{key:"subscribe",value:function(){var t;(t=this.mqtt).subscribe.apply(t,arguments)}},{key:"unsubscribe",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.logger("unsubscribe from",r),(t=this.mqtt).unsubscribe.apply(t,r)}},{key:"publish",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mqtt.publish(t,e.toString(),r)}},{key:"emit",value:function(){var t;(t=this.emitter).emit.apply(t,arguments)}},{key:"on",value:function(){var t;(t=this.emitter).on.apply(t,arguments)}},{key:"disconnect",value:function(){this.unsubscribe(Object.keys(this.mqtt._resubscribeTopics))}},{key:"noop",value:function(){}},{key:"newMessageHandler",value:function(t,e){e=JSON.parse(e),this.logger("on:new-message",e),this.emit("new-message",e)}},{key:"notificationHandler",value:function(t,e){var r=this;this.logger("on:notification",e);var n=(e=JSON.parse(e)).payload.data;"deleted_messages"in n&&n.deleted_messages.forEach(function(t){r.emit("comment-deleted",{roomId:t.room_id,commentUniqueIds:t.message_unique_ids,isForEveryone:!0,isHard:!0})}),"deleted_rooms"in n&&n.deleted_rooms.forEach(function(t){r.emit("room-cleared",t)})}},{key:"typingHandler",value:function(t,e){this.logger("on:typing",t);var r=t.match(this.reTyping);if(r[3]!==this.core.user_id){var n=r[3],i=r[1];if(this.emit("typing",{message:e,userId:n,roomId:i}),null!=this.core.selected)if("1"===e&&i===this.core.selected.id){var o=this.core.selected.participants.find(function(t){return t.email===n});if(null==o)return;var s=o.username;this.core.isTypingStatus="".concat(s," is typing ...")}else this.core.isTypingStatus=null}}},{key:"deliveryReceiptHandler",value:function(t,e){this.logger("on:delivered",t,e);var r=t.match(this.reDelivery),n=e.split(":"),i=Number(n[0]),o=n[1],s=r[3];this.emit("message-delivered",{commentId:i,commentUniqueId:o,userId:s})}},{key:"readReceiptHandler",value:function(t,e){this.logger("on:read",t,e);var r=t.match(this.reRead),n=e.split(":"),i=Number(n[0]),o=n[1],s=r[3];this.emit("message-read",{commentId:i,commentUniqueId:o,userId:s})}},{key:"onlinePresenceHandler",value:function(t,e){this.logger("on:online-presence",t),this.emit("presence",e)}},{key:"channelMessageHandler",value:function(t,e){this.logger("on:channel-message",t,e),this.emit("new-message",JSON.parse(e))}},{key:"subscribeChannel",value:function(t,e){this.subscribe("".concat(t,"/").concat(e,"/c"))}},{key:"subscribeRoom",value:function(t){null!=this.core.selected&&(t=t||this.core.selected.id,this.subscribe("r/".concat(t,"/").concat(t,"/+/t")),this.subscribe("r/".concat(t,"/").concat(t,"/+/d")),this.subscribe("r/".concat(t,"/").concat(t,"/+/r")))}},{key:"unsubscribeRoom",value:function(t){null!=this.core.selected&&(t=t||this.core.selected.id,this.unsubscribe("r/".concat(t,"/").concat(t,"/+/t")),this.unsubscribe("r/".concat(t,"/").concat(t,"/+/d")),this.unsubscribe("r/".concat(t,"/").concat(t,"/+/r")))}},{key:"subscribeUserChannel",value:function(){this.subscribe("".concat(this.core.userData.token,"/c")),this.subscribe("".concat(this.core.userData.token,"/n"))}},{key:"publishPresence",value:function(t){this.core.logging("emitting presence status for user",t),this.publish("u/".concat(t,"/s"),1,{retain:!0})}},{key:"subscribeUserPresence",value:function(t){this.subscribe("u/".concat(t,"/s"))}},{key:"unsubscribeUserPresence",value:function(t){this.unsubscribe("u/".concat(t,"/s"))}},{key:"publishTyping",value:function(t){if(null!=this.core.selected){var e=this.core.selected.id,r=this.core.user_id;this.publish("r/".concat(e,"/").concat(e,"/").concat(r,"/t"),t)}}},{key:"connected",get:function(){return this.mqtt.connected}},{key:"logger",get:function(){return this.core.debugMQTTMode?console.log.bind(console,"MQTT ->"):this.noop}},{key:"reNewMessage",get:function(){return/^([\w]+)\/c/i}},{key:"reNotification",get:function(){return/^([\w]+)\/n/i}},{key:"reTyping",get:function(){return/^r\/([\d]+)\/([\d]+)\/([\S]+)\/t$/i}},{key:"reDelivery",get:function(){return/^r\/([\d]+)\/([\d]+)\/([\S]+)\/d$/i}},{key:"reRead",get:function(){return/^r\/([\d]+)\/([\d]+)\/([\S]+)\/r$/i}},{key:"reOnlineStatus",get:function(){return/^u\/([\S]+)\/s$/i}},{key:"reChannelMessage",get:function(){return/^([\S]+)\/([\S]+)\/c/i}},{key:"subscribeTyping",get:function(){return this.subscribeRoom.bind(this)}},{key:"unsubscribeTyping",get:function(){return this.unsubscribeRoom.bind(this)}},{key:"subscribeRoomPresence",get:function(){return this.subscribeUserPresence.bind(this)}},{key:"unsubscribeRoomPresence",get:function(){return this.unsubscribeUserPresence.bind(this)}}]),t}();var tt=function(){function t(e){h()(this,t),this.baseUrl=e,this.params={}}return d()(t,[{key:"param",value:function(t,e){return this.params[t]=e,this}},{key:"build",value:function(){var t=this,e=Object.keys(this.params).filter(function(e){return null!=t.params[e]}).map(function(e){return"".concat(e,"=").concat(t.params[e])}).join("&");return[this.baseUrl,e].join("?")}}]),t}();function et(t,e){var r=e.getToken,n=e.isDebug,i=void 0!==n&&n,o=e.interval,s=void 0===o?5e3:o,a=y(),u=0,c=0;return{events:a,synchronize:R()(function(e){e=e||u;var n=new tt("api/v2/sdk/sync").param("token",r()).param("last_received_comment_id",e).build();t().get(n).then(function(t){var e=t.body.results,r=e.comments;u=e.meta.last_received_comment_id,a.emit("last-message-id",u),r.forEach(function(t){return a.emit("message.new",t)})},function(t){return function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return i?(t=console).log.apply(t,["QSync:"].concat(r)):{}}("Error when synchonize",t)})},s),synchronizeEvent:R()(function(e){e=e||c;var n=new tt("api/v2/sdk/sync_event").param("token",r()).param("start_event_id",e).build();t().get(n).then(function(t){var e=t.body.events,r=e.map(function(t){return t.id}).slice().sort(function(t,e){return t-e}).pop();null!=r&&(c=r,a.emit("last-event-id",c)),e.filter(function(t){return"delivered"===t.action_topic}).forEach(function(t){return a.emit("message.delivered",t.payload.data)}),e.filter(function(t){return"read"===t.action_topic}).forEach(function(t){return a.emit("message.read",t.payload.data)}),e.filter(function(t){return"delete_message"===t.action_topic}).forEach(function(t){return a.emit("message.deleted",t.payload.data)}),e.filter(function(t){return"clear_room"===t.action_topic}).forEach(function(t){return a.emit("room.deleted",t.payload.data)})})},s)}}var rt=r(71),nt=function(){function t(){h()(this,t),this.events=y(),this.rooms=[],this.selected=null,this.room_name_id_map={},this.pendingCommentId=0,this.uploadedFiles=[],this.chatmateStatus=null,this.version="WEB_".concat(rt.version),this.userData={},this.AppId=null,this.baseURL="https://api.qiscus.com",this.uploadURL="".concat(this.baseURL,"/api/v2/sdk/upload"),this.mqttURL="wss://mqtt.qiscus.com:1886/mqtt",this.HTTPAdapter=null,this.realtimeAdapter=null,this.customEventAdapter=null,this.isInit=!1,this.isSynced=!1,this.syncInterval=5e3,this.sync="socket",this.httpsync=null,this.eventsync=null,this.extras=null,this.last_received_comment_id=0,this.googleMapKey="",this.options={avatar:!0},this.UI={},this.mode="widget",this.avatar=!0,this.plugins=[],this.isLogin=!1,this.isLoading=!1,this.isInit=!1,this.emoji=!1,this.isTypingStatus="",this.customTemplate=!1,this.templateFunction=null,this.debugMode=!1,this.debugMQTTMode=!1,this.lastReceiveMessages=[]}return d()(t,[{key:"init",value:function(t){var e=this;if(!t.AppId)throw new Error("Please provide valid AppId");this.AppId=t.AppId,t.baseURL&&(this.baseURL=t.baseURL),t.mqttURL&&(this.mqttURL=t.mqttURL),t.uploadURL&&(this.uploadURL=t.uploadURL),t.sync&&(this.sync=t.sync),t.mode&&(this.mode=t.mode),t.syncInterval&&(this.syncInterval=t.syncInterval||5e3),t.googleMapKey&&(this.googleMapKey=t.googleMapKey),t.allowedFileTypes&&(this.allowedFileTypes=t.allowedFileTypes),t.options&&(this.options=Object.assign({},this.options,t.options)),t.customTemplate&&(this.customTemplate=t.customTemplate),t.templateFunction&&(this.templateFunction=t.templateFunction),null!=t.syncInterval&&(this.syncInterval=t.syncInterval),this.setEventListeners(),this.syncAdapter=et(function(){return e.HTTPAdapter},{getToken:function(){return e.userData.token},interval:this.syncInterval}),this.syncAdapter.events.on("message.new",function(t){if(null!=e.selected){if(-1===e.selected.comments.findIndex(function(e){return e.id===t.id||e.unique_id===t.unique_temp_id})){var r=new A(t);r.room_id===e.selected.id&&(e.selected.comments.push(r),e.sortComments()),e.events.emit("newmessages",[t])}}else e.events.emit("newmessages",[t])}),this.syncAdapter.events.on("message.delivered",function(t){e._setDelivered(t.comment_id,t.comment_unique_id,t.email)}),this.syncAdapter.events.on("message.read",function(t){e._setRead(t.comment_id,t.comment_unique_id,t.email)}),this.syncAdapter.events.on("message.deleted",function(t){t.deleted_messages.forEach(function(t){e.events.emit("comment-deleted",{roomId:t.room_id,commentUniqueIds:t.message_unique_ids,isForEveryone:!0,isHard:!0})})}),this.syncAdapter.events.on("room.deleted",function(t){t.deleted_rooms.forEach(function(t){e.events.emit("room-cleared",t)})}),this.realtimeAdapter=new Z(this.mqttURL,this),this.realtimeAdapter.on("message-delivered",function(t){var r=t.commentId,n=t.commentUniqueId,i=t.userId;return e._setDelivered(r,n,i)}),this.realtimeAdapter.on("message-read",function(t){var r=t.commentId,n=t.commentUniqueId,i=t.userId;return e._setRead(r,n,i)}),this.realtimeAdapter.on("new-message",function(t){return e.events.emit("newmessages",[t])}),this.realtimeAdapter.on("presence",function(t){return e.events.emit("presence",t)}),this.realtimeAdapter.on("comment-deleted",function(t){return e.events.emit("comment-deleted",t)}),this.realtimeAdapter.on("room-cleared",function(t){return e.events.emit("room-cleared",t)}),this.realtimeAdapter.on("typing",function(t){return e.events.emit("typing",{message:t.message,username:t.userId,room_id:t.roomId})}),this.customEventAdapter=function(t,e){var r=y(),n={},i=/^r\/[\w]+\/[\w]+\/e$/i;t.mqtt.on("message",function(t,e){i.test(t)&&r.emit(t,e)});var o=function(t){return"r/".concat(t,"/").concat(t,"/e")};return{publishEvent:function(r,n){if(_.a.undefined(r))throw new Error("`roomId` required");if(_.a.not.string(r))throw new TypeError("`roomId` must have type of string");if(_.a.undefined(n))throw new Error("`payload` required");if(_.a.not.object(n))throw new TypeError("`payload` must have type of object");var i=JSON.stringify({sender:e,data:n});t.mqtt.publish(o(r),i)},subscribeEvent:function(e,i){if(_.a.undefined(e))throw new Error("`roomId` required");if(_.a.not.string(e))throw new TypeError("`roomId` must have type of string");if(_.a.undefined(i))throw new Error("`callback` required");if(_.a.not.function(i))throw new TypeError("`callback` must have type of function");var s=o(e);if(!n[s]){t.mqtt.subscribe(s);var a=function(t){var e=JSON.parse(t);i(e)};r.on(s,a),n[s]=a}},unsubscribeEvent:function(e){if(_.a.undefined(e))throw new Error("`roomId` required");if(_.a.not.string(e))throw new TypeError("`roomId` must have type of string");var i=o(e);n[i]&&(t.mqtt.unsubscribe(i),r.off(i,n[i]),n[i]=null,delete n[i])}}}(this.realtimeAdapter,this.user_id)}},{key:"_setRead",value:function(t,e,r){if(null!=this.selected){var n=this.selected,i=n.comments.find(function(r){return r.id===t||r.unique_id===e});if(null!=i&&"read"!==i.status){var o={participants:n.participants,actor:r,comment_id:t,activeActorId:this.user_id};n.comments.forEach(function(t){t.id<=i.id&&t.markAsRead(o)}),i.isRead&&this.events.emit("comment-read",{comment:i,userId:r})}}}},{key:"_setDelivered",value:function(t,e,r){if(null!=this.selected){var n=this.selected,i=n.comments.find(function(r){return r.id===t||r.unique_id===e});if(null!=i&&"read"!==i.status){var o={participants:n.participants,actor:r,comment_id:t,activeActorId:this.user_id};n.comments.forEach(function(t){t.id<=i.id&&t.markAsDelivered(o)}),i.isDelivered&&this.events.emit("comment-delivered",{comment:i,userId:r})}}}},{key:"readComment",value:function(t,e){var r=this.selected&&this.selected.id===t||!1,n=this.selected&&this.selected.isChannel||!1;if(!r||n)return!1;this.userAdapter.updateCommentStatus(t,e,null)}},{key:"receiveComment",value:function(t,e){if(!!this.selected&&this.selected.isChannel)return!1;this.userAdapter.updateCommentStatus(t,null,e)}},{key:"setEventListeners",value:function(){var t=this,e=this;e.events.on("start-init",function(){e.HTTPAdapter=new P({baseURL:e.baseURL,AppId:e.AppId,userId:e.user_id,version:e.version}),e.HTTPAdapter.setToken(e.userData.token),e.authAdapter=new O(e.HTTPAdapter)}),e.events.on("room-changed",function(r){t.logging("room changed",r),e.options.roomChangedCallback&&e.options.roomChangedCallback(r)}),e.events.on("file-uploaded",function(t){e.options.fileUploadedCallback&&e.options.fileUploadedCallback(t)}),e.events.on("profile-updated",function(t){e.username=t.name,e.avatar_url=t.avatar_url,e.options.updateProfileCallback&&e.options.updateProfileCallback(t)}),e.events.on("newmessages",function(r){t.logging("newmessages",r),t.lastReceiveMessages.length>0&&t.lastReceiveMessages[0].unique_temp_id===r[0].unique_temp_id?t.logging("lastReceiveMessages double",r):(t.lastReceiveMessages=r,e._callNewMessagesCallback(r),r.forEach(function(r){e.receiveComment(r.room_id,r.id);var n=!!e.selected&&r.room_id===e.selected.id,i=r.id<=e.last_received_comment_id;if(n){var o=e.selected,s=e.selected.comments[e.selected.comments.length-1];s.isPending||i||e.user_id===r.email||e.readComment(r.room_id,r.id);var a=s.id,u=e.selected.comments.find(function(t){return t.id===s.comment_before_id});s.isPending||u||(t.logging("comment before id not found! ",r.comment_before_id),e.synchronize(a));var c=new A(r);o.receiveComment(c),o.last_comment_id=c.id,o.last_comment_message=c.message}e.updateLastReceivedComment(r.id),t.sortComments()}))}),this.events.on("login-success",function(e){t.logging("login-success",e),t.isLogin=!0,t.userData=e.user,t.last_received_comment_id=t.userData.last_comment_id,t.HTTPAdapter=new P({baseURL:t.baseURL,AppId:t.AppId,userId:t.user_id,version:t.version}),t.HTTPAdapter.setToken(t.userData.token),t.userAdapter=new j(t.HTTPAdapter),t.roomAdapter=new M(t.HTTPAdapter),t.realtimeAdapter.subscribeUserChannel(),null!=t.presensePublisherId&&-1!==t.presensePublisherId&&clearInterval(t.presensePublisherId),t.presensePublisherId=setInterval(function(){return t.realtimeAdapter.publishPresence(t.user_id)},3500),"http"!==t.sync&&"both"!==t.sync||t.activateSync(),t.options.loginSuccessCallback&&t.options.loginSuccessCallback(e)}),e.events.on("login-error",function(t){e.options.loginErrorCallback&&e.options.loginErrorCallback(t)}),e.events.on("room-cleared",function(t){if(e.selected){var r=e.selected;e.selected.unique_id===t.unique_id&&(e.selected=null,e.selected=r)}e.options.roomClearedCallback&&e.options.roomClearedCallback(t)}),e.events.on("comment-deleted",function(t){var r=t.roomId,n=t.commentUniqueIds,i=(t.isForEveryone,t.isHard);e.selected&&e.selected.id===r&&n.map(function(t){var r=e.selected.comments.findIndex(function(e){return e.unique_id===t});r>-1&&(i?e.selected.comments.splice(r,1):e.selected.comments[r].message="this message has been deleted")}),e.options.commentDeletedCallback&&e.options.commentDeletedCallback(t)}),e.events.on("comment-delivered",function(t){return e.logging("comment-delivered",t),!!t&&(e.options.commentDeliveredCallback?e.options.commentDeliveredCallback(t):void 0)}),e.events.on("chat-room-created",function(t){e.isLoading=!1,e.options.chatRoomCreatedCallback&&e.options.chatRoomCreatedCallback(t)}),e.events.on("group-room-created",function(t){e.isLoading=!1,e.options.groupRoomCreatedCallback&&e.options.groupRoomCreatedCallback(t)}),e.events.on("header-clicked",function(t){e.options.headerClickedCallback&&e.options.headerClickedCallback(t)}),e.events.on("comment-read",function(t){e.logging("comment-read",t),e.options.commentReadCallback&&e.options.commentReadCallback(t)}),e.events.on("presence",function(t){var r=t.split(":");e.chatmateStatus!==r[0]&&(e.chatmateStatus=1===r[0]?"Online":"Last seen ".concat(S()(Number(r[1].substring(0,13))))),e.options.presenceCallback&&e.options.presenceCallback(t)}),e.events.on("typing",function(t){e.options.typingCallback&&e.options.typingCallback(t)}),e.events.on("message-info",function(t){e.options.messageInfoCallback&&e.options.messageInfoCallback(t)}),e.events.on("participants-added",function(e){var r;null!=e&&null!=t.selected&&(r=t.selected.participants).push.apply(r,l()(e))}),e.events.on("participants-removed",function(e){if(null!=e&&null!=t.selected){var r=t.selected.participants.filter(function(t){return e.indexOf(t.email)<=-1});t.selected.participants=r}}),e.events.on("block-user",function(t){e.options.blockUserCallback&&e.options.blockUserCallback(t)}),e.events.on("unblock-user",function(t){e.options.unblockUserCallback&&e.options.unblockUserCallback(t)})}},{key:"onReconnectMqtt",value:function(){this.selected&&(this.options.onReconnectCallback&&this.options.onReconnectedCallback(),this.loadComments(this.selected.id))}},{key:"_callNewMessagesCallback",value:function(t){this.options.newMessagesCallback&&this.options.newMessagesCallback(t)}},{key:"updateLastReceivedComment",value:function(t){this.last_received_comment_id<t&&(this.last_received_comment_id=t)}},{key:"setUser",value:function(t,e,r,n,i){var o=this;o.events.emit("start-init"),o.user_id=t,o.key=e,o.username=r,o.avatar_url=n;var s={email:this.user_id,password:this.key,username:this.username,extras:i?JSON.stringify(i):null};return this.avatar_url&&(s.avatar_url=this.avatar_url),o.authAdapter.loginOrRegister(s).then(function(t){o.isInit=!0,o.events.emit("login-success",t)},function(t){return o.events.emit("login-error",t)})}},{key:"setUserWithIdentityToken",value:function(t){if(!(t&&"user"in t))return this.events.emit("login-error",t);this.email=t.user.email,this.user_id=t.user.email,this.key=t.identity_token,this.username=t.user.username,this.avatar_url=t.user.avatar_url,this.isInit=!0,this.events.emit("login-success",t)}},{key:"logout",value:function(){this.selected=null,this.isInit=!1,this.isLogin=!1,this.userData={},this.realtimeAdapter.disconnect()}},{key:"activateSync",value:function(){var t=this;this.isSynced||(this.isSynced=!0,this.httpsync=setInterval(function(){t.realtimeAdapter.connected||t.synchronize()},this.syncInterval),this.eventsync=setInterval(function(){t.realtimeAdapter.connected||t.synchronizeEvent()},this.syncInterval))}},{key:"disableSync",value:function(){this.isSynced=!1,clearInterval(this.httpsync),clearInterval(this.eventsync)}},{key:"disconnect",value:function(){this.logout()}},{key:"setActiveRoom",value:function(t){var e=this;if(this.selected&&(this.realtimeAdapter.unsubscribeTyping(),"single"===this.selected.room_type)){var r=this.selected.participants.filter(function(t){return t.email!==e.user_id});r.length>0&&this.realtimeAdapter.unsubscribeRoomPresence(r[0].email)}null==t.participants&&(t.participants=[]);var n=t.participants.find(function(t){return t.email!==e.user_id});this.chatmateStatus=null,this.isTypingStatus=null,this.selected=t;var i=setInterval(function(){e.debugMode&&console.log("Trying Initial Subscribe"),null!=e.realtimeAdapter?(e.debugMode&&(console.log(e.realtimeAdapter),console.log("MQTT Connected")),clearInterval(i),"single"===t.room_type&&null!=n&&e.realtimeAdapter.subscribeRoomPresence(n.email),null==e.selected||e.selected.isChannel||(e.realtimeAdapter.subscribeTyping(t.id),e.events.emit("room-changed",e.selected)),e.debugMode&&null==e.realtimeAdapter&&console.log("Retry")):e.debugMode&&console.log("MQTT Not Connected, yet")},3e3)}},{key:"chatTarget",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=this.userData.length)return!1;var n=r?r.message:null,i=r.distinctId;return this.isLoading=!0,this.isTypingStatus="",this.roomAdapter.getOrCreateRoom(t,r,i).then(function(t){var r=new I(t);e.last_received_comment_id<r.last_comment_id&&(e.last_received_comment_id=r.last_comment_id),e.isLoading=!1,e.setActiveRoom(r);var i=r.comments[r.comments.length-1];if(i&&e.readComment(r.id,i.id),e.events.emit("chat-room-created",{room:r}),!n)return r;var o=r.id;return e.sendComment(o,n).then(function(){return Promise.resolve(r)}).catch(function(t){console.error("Error when submit comment",t)})},function(t){return console.error("Error when creating room",t),e.isLoading=!1,Promise.reject(t)})}},{key:"chatGroup",value:function(t){if(this.isInit)return this.getRoomById(t).then(function(t){return Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"getRoomById",value:function(t){var e=this;if(this.isInit){var r=this;return r.isLoading=!0,r.isTypingStatus="",r.roomAdapter.getRoomById(t).then(function(t){var n=t.results.room;n.name=n.room_name,n.comments=t.results.comments.reverse();var i=new I(n);r.last_received_comment_id=r.last_received_comment_id<i.last_comment_id?i.last_comment_id:r.last_received_comment_id,r.setActiveRoom(i),r.isLoading=!1;var o=i.comments[i.comments.length-1];return o&&r.readComment(i.id,o.id),i.isChannel&&e.realtimeAdapter.subscribeChannel(e.AppId,i.unique_id),Promise.resolve(i)},function(t){return console.error("Error getting room by id",t),Promise.reject(t)})}}},{key:"getOrCreateRoomByUniqueId",value:function(t,e,r){var n=this,i=this;return i.isLoading=!0,i.isTypingStatus="",i.roomAdapter.getOrCreateRoomByUniqueId(t,e,r).then(function(t){var e=new I(t);i.last_received_comment_id=i.last_received_comment_id<e.last_comment_id?e.last_comment_id:i.last_received_comment_id,i.setActiveRoom(e),i.isLoading=!1;var r=e.comments[e.comments.length-1];return r&&i.readComment(e.id,r.id),n.realtimeAdapter.subscribeChannel(n.AppId,e.unique_id),Promise.resolve(e)},function(t){return Promise.reject(t)})}},{key:"getOrCreateRoomByChannel",value:function(t,e,r){return this.getOrCreateRoomByUniqueId(t,e,r)}},{key:"sortComments",value:function(){this.selected&&this.selected.comments.sort(function(t,e){return t.unix_timestamp-e.unix_timestamp})}},{key:"loadRoomList",value:function(){var t=u()(s.a.mark(function t(){var e,r,n=arguments;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},t.next=3,this.userAdapter.loadRoomList(e);case 3:return r=t.sent,t.abrupt("return",r.map(function(t){return t.last_comment_id=t.last_comment.id,t.last_comment_message=t.last_comment.message,t.last_comment_message_created_at=t.last_comment.timestamp,t.room_type=t.chat_type,t.comments=[],new I(t)}));case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"loadComments",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.userAdapter.loadComments(t,r).then(function(t){return null!=e.selected&&(e.selected.receiveComments(t.reverse()),e.sortComments()),Promise.resolve(t)})}},{key:"loadMore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=this.selected)return e.last_comment_id=t,e.after=!1,this.loadComments(this.selected.id,e)}},{key:"searchMessages",value:function(){var t=u()(s.a.mark(function t(){var e,r,n=arguments;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},console.warn("Deprecated: search message will be removed on next release"),t.next=4,this.userAdapter.searchMessages(e);case 4:return r=t.sent,t.abrupt("return",r.map(function(t){return new A(t)}));case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"updateProfile",value:function(t){var e=this;return this.userAdapter.updateProfile(t).then(function(r){e.events.emit("profile-updated",t)},function(t){return console.log(t)})}},{key:"getNonce",value:function(){return v.a.post("".concat(this.baseURL,"/api/v2/sdk/auth/nonce")).send().set("qiscus_sdk_app_id","".concat(this.AppId)).set("qiscus_sdk_version","".concat(this.version)).then(function(t){return Promise.resolve(t.body.results)},function(t){return Promise.reject(t)})}},{key:"verifyIdentityToken",value:function(t){return v.a.post("".concat(this.baseURL,"/api/v2/sdk/auth/verify_identity_token")).send({identity_token:t}).set("qiscus_sdk_app_id","".concat(this.AppId)).set("qiscus_sdk_version","".concat(this.version)).then(function(t){return Promise.resolve(t.body.results)},function(t){return Promise.reject(t)})}},{key:"sendComment",value:function(t,e,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=this;a.options.prePostCommentCallback&&a.options.prePostCommentCallback(e),a.options.commentFormaterCallback&&(e=a.options.commentFormaterCallback(e)),a.pendingCommentId--;var u={message:e,username_as:this.username,username_real:this.user_id,user_avatar_url:this.userData.avatar_url,id:Math.round(1e7*Math.random()),type:i||"text",timestamp:w()(new Date),unique_id:r};"text"!==i&&(u.payload=JSON.parse(o));var c=a.prepareCommentToBeSubmitted(u);if("reply"===i){var l=JSON.parse(o),f=a.selected.comments.find(function(t){return t.id===l.replied_comment_id});l.replied_comment_message="reply"===f.type?f.payload.text:f.message,l.replied_comment_sender_username=f.username_as,c.payload=l}a.selected&&a.selected.comments.push(c);var h=s||a.extras;return this.userAdapter.postComment(t,e,c.unique_id,i,o,h).then(function(t){return a.selected?(c.markAsSent(),c.markAsRead({participants:n.selected.participants,actor:n.user_id,comment_id:t.id,activeActorId:n.user_id}),c.id=t.id,c.before_id=t.comment_before_id,c.unix_timestamp=t.unix_timestamp,a.sortComments(),Promise.resolve(t)):Promise.resolve(t)},function(t){return c.markAsFailed(),Promise.reject(t)})}},{key:"getUsers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return this.HTTPAdapter.get_request("api/v2/sdk/get_user_list").query({token:this.userData.token,query:t,page:e,limit:r}).then(function(t){return Promise.resolve(t.body.results)})}},{key:"getRoomParticipants",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.HTTPAdapter.get_request("api/v2/sdk/room_participants").query({token:this.userData.token,room_unique_id:t,offset:e}).then(function(t){return Promise.resolve(t.body.results)})}},{key:"resendComment",value:function(t){if(null!=this.selected){var e=this,r=e.selected,n=r.comments.find(function(e){return e.id===t.id}),i=e.extras;return this.userAdapter.postComment(r.id,n.message,n.unique_id,t.type,t.payload,i).then(function(t){return n.markAsSent(),n.id=t.id,n.before_id=t.comment_before_id,new Promise(function(t,r){return t(e.selected)})},function(t){return n.markAsFailed(),new Promise(function(e,r){return r(t)})})}}},{key:"prepareCommentToBeSubmitted",value:function(t){var e,r;return e=new A(t),r="bq"+Date.now(),t.unique_id&&(r=t.unique_id),e.attachUniqueId(r),e.markAsPending(),e.isDelivered=!1,e.isSent=!1,e.isRead=!1,e.unix_timestamp=Math.round((new Date).getTime()/1e3),e}},{key:"updateRoom",value:function(t){return this.roomAdapter.updateRoom(t)}},{key:"removeSelectedRoomParticipants",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";if(_.a.not.array(t))return Promise.reject(new Error("`values` must have type of array"));var r=this.selected.participants;if(!r)return Promise.reject(new Error("Nothing selected room chat."));var n=r;return"id"===e&&(n=r.filter(function(e){return t.indexOf(e.id)<=-1})),"email"===e&&(n=r.filter(function(e){return t.indexOf(e.email)<=-1})),"username"===e&&(n=r.filter(function(e){return t.indexOf(e.username)<=-1})),this.selected.participants=n,Promise.resolve(r)}},{key:"createGroupRoom",value:function(t,e,r){var n=this;if(!this.isLogin)throw new Error("Please initiate qiscus SDK first");return new T(this.roomAdapter).withName(t).withOptions(r).addParticipants(e).create().then(function(t){return n.events.emit("group-room-created",t),Promise.resolve(t)})}},{key:"addParticipantsToGroup",value:function(t,e){var r=this;if(!Array.isArray(e))throw new Error("emails' must be type of Array");return r.roomAdapter.addParticipantsToGroup(t,e).then(function(t){return r.events.emit("participants-added",t),Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"removeParticipantsFromGroup",value:function(t,e){var r=this;return _.a.not.array(e)?Promise.reject(new Error("`emails` must have type of array")):this.roomAdapter.removeParticipantsFromGroup(t,e).then(function(t){return r.events.emit("participants-removed",e),Promise.resolve(t)})}},{key:"getBlockedUser",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return this.userAdapter.getBlockedUser(t,e).then(function(t){return Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"blockUser",value:function(t){var e=this;return e.userAdapter.blockUser(t).then(function(t){return e.events.emit("block-user",t),Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"unblockUser",value:function(t){var e=this;return e.userAdapter.unblockUser(t).then(function(t){return e.events.emit("unblock-user",t),Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"upload",value:function(t,e){return v.a.post(this.uploadURL).attach("file",t).field("token",this.userData.token).set("qiscus_sdk_app_id",this.AppId).set("qiscus_sdk_token",this.userData.token).set("qiscus_sdk_user_id",this.user_id).on("progress",function(t){"upload"===t.direction&&e(null,t)}).then(function(t){var r=t.body.results.file.url;return e(null,null,t.body.results.file.url),Promise.resolve(r)}).catch(function(t){return e(t),Promise.reject(t)})}},{key:"uploadFile",value:function(t,e){var r=this,n=new FormData;n.append("file",e),n.append("token",r.userData.token);var i=new XMLHttpRequest;i.open("POST","".concat(r.baseURL,"/api/v2/sdk/upload"),!0),i.setRequestHeader("qiscus_sdk_app_id","".concat(r.AppId)),i.setRequestHeader("qiscus_sdk_user_id","".concat(r.user_id)),i.setRequestHeader("qiscus_sdk_token","".concat(r.userData.token)),i.onload=function(){if(200===i.status){var e=JSON.parse(i.response).results.file.url;return r.events.emit("fileupload",e),r.sendComment(t,"[file] ".concat(e," [/file]"))}return Promise.reject(i)},i.send(n)}},{key:"addUploadedFile",value:function(t,e){this.uploadedFiles.push(new it(t,e))}},{key:"removeUploadedFile",value:function(t,e){var r=this.uploadedFiles.findIndex(function(r){return r.name===t&&r.roomId===e});this.uploadedFiles.splice(r,1)}},{key:"publishTyping",value:function(t){this.realtimeAdapter.publishTyping(t)}},{key:"getRoomsInfo",value:function(t){return this.userAdapter.getRoomsInfo(t)}},{key:"deleteComment",value:function(t,e,r,n){var i=this;if(!Array.isArray(e))throw new Error("unique ids' must be type of Array");return this.userAdapter.deleteComment(t,e,r,n).then(function(o){return i.events.emit("comment-deleted",{roomId:t,commentUniqueIds:e,isForEveryone:r,isHard:n}),Promise.resolve(o)},function(t){return Promise.reject(t)})}},{key:"clearRoomsCache",value:function(){var t=this;if(this.selected){this.room_name_id_map=i()({},this.selected.name,this.selected.id);var e=this.rooms.length,r=this.rooms.findIndex(function(e){return e.id===t.selected.id});r+1!==e&&this.rooms.splice(r+1,e-(r+1)),(r=this.rooms.findIndex(function(e){return e.id===t.selected.id}))>0&&this.rooms.length>1&&this.rooms.splice(1,this.rooms.length-1)}}},{key:"exitChatRoom",value:function(){this.realtimeAdapter.unsubscribeTyping(),this.realtimeAdapter.unsubscribeRoomPresence(),this.selected=null}},{key:"clearRoomMessages",value:function(t){if(!Array.isArray(t))throw new Error("room_ids must be type of array");return this.userAdapter.clearRoomMessages(t)}},{key:"logging",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.debugMode&&console.log(t,e)}},{key:"getTotalUnreadCount",value:function(){return this.roomAdapter.getTotalUnreadCount().then(function(t){return Promise.resolve(t)},function(t){return Promise.reject(t)})}},{key:"publishEvent",value:function(){var t;(t=this.customEventAdapter).publishEvent.apply(t,arguments)}},{key:"subscribeEvent",value:function(){var t;(t=this.customEventAdapter).subscribeEvent.apply(t,arguments)}},{key:"unsubscribeEvent",value:function(){var t;(t=this.customEventAdapter).unsubscribeEvent.apply(t,arguments)}},{key:"noop",value:function(){}},{key:"synchronize",get:function(){return this.syncAdapter.synchronize}},{key:"synchronizeEvent",get:function(){return this.syncAdapter.synchronizeEvent}},{key:"logger",get:function(){return this.debugMode?console.log.bind(console,"Qiscus ->"):this.noop}}]),t}(),it=function t(e,r){h()(this,t),this.name=e,this.roomId=r,this.progress=0};e.default=nt}]).default});
//# sourceMappingURL=qiscus-sdk-core.min.js.map